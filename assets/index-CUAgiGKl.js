import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-B0nG_uX1.js";import{d as H,$ as L,a0 as Q,ai as q,S as K,x as W,aj as X,aO as Z,J as ee,m as ae,V as te,ah as ne,au as oe,at as se}from"./antd-_WrWzocG.js";import{_ as le}from"./detail.vue_vue_type_script_setup_true_lang-CJp7DPk4.js";import{b as ue,B as N,a as ie}from"./bought-CyPNQ2Qw.js";import{u as de}from"./index-H6zaxqu3.js";import{d as pe,f as m,r as re,w as _e,c as me,o as ce,a5 as i,ac as v,ad as e,k as a,u as s,a3 as k,F as x,al as fe,G as d,af as y,H as T,ag as c,ak as ge,a8 as ve}from"./vue-f4UZefmh.js";import"./context-zShw-svS.js";import"./shop-CfMZuAkq.js";const ke=ve("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录管理",-1),De=pe({__name:"index",setup(xe){const f=m(!1),U=m([{title:"#",dataIndex:"id"},{title:"商品名",dataIndex:"shopName"},{title:"购买日期",dataIndex:"datetime"},{title:"自动续费",dataIndex:"renew"},{title:"价格",dataIndex:"price"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action"}]),C=m(),p=re({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`${t}条记录`,onChange(t,n){p.pageSize=n,p.current=t,b()}}),l=m({userName:"",shopName:"",boughtStatus:void 0,startDateTime:void 0,endDateTime:void 0,renew:void 0});async function b(){if(!f.value){f.value=!0;try{const{data:t}=await ue({size:p.pageSize,current:p.current,param:l.value});C.value=t.records,p.total=t.total,p.pageSize=t.size,p.current=t.current}finally{f.value=!1}}}const r=m(!1),D=m(0),M=de();function V(t){r.value=!0,D.value=t.snapshotId}const w=m();_e(w,t=>{l.value.startDateTime=t?t[0]:void 0,l.value.endDateTime=t?t[1]:void 0});const O=me(()=>{const t={};for(const n in N)t[n]=N[n];return t});async function Y(t){await ie(t.userid,t.id),M.success("套餐激活成功")}return ce(()=>{b()}),(t,n)=>{const $=L,g=Q,_=q,S=K,z=W,h=X,j=Z,I=ee,F=ae,P=te,B=ne,R=oe,A=se,E=G;return i(),v(E,null,{title:e(()=>[ke]),default:e(()=>[a(B,{"mb-4":""},{default:e(()=>[a(P,{modal:s(l)},{default:e(()=>[a(h,{gutter:16},{default:e(()=>[a(_,{span:8},{default:e(()=>[a(g,{label:"用户名",name:"userName"},{default:e(()=>[a($,{value:s(l).userName,"onUpdate:value":n[0]||(n[0]=o=>s(l).userName=o)},null,8,["value"])]),_:1})]),_:1}),a(_,{span:8},{default:e(()=>[a(g,{label:"商品名",name:"shopName"},{default:e(()=>[a($,{value:s(l).shopName,"onUpdate:value":n[1]||(n[1]=o=>s(l).shopName=o)},null,8,["value"])]),_:1})]),_:1}),a(_,{span:8},{default:e(()=>[a(g,{label:"购买状态",name:"boughtStatus"},{default:e(()=>[a(z,{value:s(l).boughtStatus,"onUpdate:value":n[2]||(n[2]=o=>s(l).boughtStatus=o)},{default:e(()=>[(i(!0),k(x,null,fe(s(O),(o,u)=>(i(),v(S,{key:u,value:u},{default:e(()=>[d(y(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(h,{gutter:16},{default:e(()=>[a(_,{span:8},{default:e(()=>[a(g,{label:"购买日期"},{default:e(()=>[a(j,{value:s(w),"onUpdate:value":n[3]||(n[3]=o=>T(w)?w.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),a(_,{span:8},{default:e(()=>[a(g,{label:"自动续期",name:"renew"},{default:e(()=>[a(z,{value:s(l).renew,"onUpdate:value":n[4]||(n[4]=o=>s(l).renew=o),"allow-clear":!0},{default:e(()=>[a(S,{value:1},{default:e(()=>[d(" 开启 ")]),_:1}),a(S,{value:0},{default:e(()=>[d(" 关闭 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(h,{span:24,style:{"text-align":"right"}},{default:e(()=>[a(_,{span:24},{default:e(()=>[a(F,{flex:"","justify-end":"","w-full":""},{default:e(()=>[a(I,{loading:s(f),type:"primary",onClick:b},{default:e(()=>[d(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),a(h,{gutter:16},{default:e(()=>[a(_,{span:24},{default:e(()=>[a(B,{title:"购买记录"},{default:e(()=>[a(R,{loading:s(f),columns:s(U),"data-source":s(C),pagination:s(p),scroll:{x:100}},{bodyCell:e(({column:o,record:u})=>[o.dataIndex==="shopName"?(i(),v(I,{key:0,type:"link",onClick:J=>V(u)},{default:e(()=>[d(y(u.shopName),1)]),_:2},1032,["onClick"])):c("",!0),o.dataIndex==="datetime"?(i(),k(x,{key:1},[d(y(s(H)(u.datetime).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="renew"?(i(),k(x,{key:2},[d(y(u.renew?"开启":"关闭"),1)],64)):c("",!0),o.dataIndex==="status"?(i(),k(x,{key:3},[d(y(s(N)[u.status]),1)],64)):c("",!0),o.dataIndex==="action"?(i(),k(x,{key:4},[u.status==="no_use"?(i(),v(I,{key:0,type:"primary",onClick:J=>Y(u)},{default:e(()=>[d(" 激活套餐 ")]),_:2},1032,["onClick"])):c("",!0)],64)):c("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),a(A,{open:s(r),"onUpdate:open":n[5]||(n[5]=o=>T(r)?r.value=o:null),width:"800px",title:"详情",onCancel:n[6]||(n[6]=o=>r.value=!1),onOk:n[7]||(n[7]=o=>r.value=!1)},{default:e(()=>[s(r)?(i(),v(ge(le),{key:0,"snapshot-id":s(D)},null,8,["snapshot-id"])):c("",!0)]),_:1},8,["open"])]),_:1})}}});export{De as default};
