import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-C84BVVK1.js";import{aO as ye,d as Ce,aP as he,K as be,N as we,aa as Ie,av as $e,ab as ze,aK as Le,aI as Ne,aJ as Se,S as Ue,m as Ae,F as De,a9 as Ee,Q as Be,aQ as Oe,D as Ve,ag as Re,a0 as Fe,aw as Me,an as Qe,s as Ye}from"./antd-D9bc_wb_.js";import{u as je,_ as Te,d as He}from"./edit.vue_vue_type_script_setup_true_lang-DONNeKp0.js";import{_ as Je}from"./charge.vue_vue_type_script_setup_true_lang-DGD9cg5J.js";import{_ as Ke}from"./bought.vue_vue_type_script_setup_true_lang-blqfQ3p2.js";import{u as Pe}from"./index-BfS-IcDm.js";import{d as Ge,f as r,s as H,c as F,r as J,w as K,o as qe,a5 as d,ac as c,ad as e,k as t,u as n,H as P,a3 as M,F as Q,al as We,G as u,af as x,ag as _,ak as G,a8 as Xe}from"./vue-CP9fVXMC.js";import"./context-oPRPwbiC.js";import"./code-6DA-GZM4.js";import"./bought-B2st0ihl.js";var m=(f=>(f.normal="正常",f.expire="到期",f.excess="超额",f.paid="付费",f.forbidden="禁用",f.delete="注销",f))(m||{});const Ze=Xe("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),rt=Ge({__name:"index",setup(f){const $=r(!1),A=r(!1),D=H([{title:"#",dataIndex:"id"},{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"分组",dataIndex:"group"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",width:200}]),v=F(()=>D.value.map(a=>a.dataIndex)),E=r(),p=J({indeterminate:!1,checkAll:!0,checkList:v.value}),q=F(()=>D.value.map(a=>a.dataIndex==="action"?{label:a.title,value:a.dataIndex,disabled:!0}:{label:a.title,value:a.dataIndex})),W=F(()=>{const a={};for(const l in m)a[l]=m[l];return a}),Y=r(),g=J({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,l){g.pageSize=l,g.current=a,w()}}),s=r({}),C=r(!1);async function w(){if(!$.value){$.value=!0;try{const{data:a}=await je({size:g.pageSize,current:g.current,param:s.value});Y.value=a.records,g.total=a.total,g.pageSize=a.size,g.current=a.current}finally{$.value=!1}}}function z(a){return D.value.filter(l=>a.includes(l.dataIndex))}const I=r(z(v.value));function X(a){Object.assign(p,{checkList:a.target.checked?v.value:[],indeterminate:!0}),I.value=a.target.checked?z(v.value):I.value.filter(l=>l.dataIndex==="action")}K(()=>p.checkList,a=>{p.indeterminate=!!a.length&&a.length<v.value.length,p.checkAll=a.length===v.value.length});function Z(){p.checkList=v.value,I.value=z(v.value)}const ee=r();function te(){w()}function ae(a){const l=z(a);I.value=l}function ne(a){E.value=a.id,C.value=!0}async function le(a){await He(a),Pe().success("用户删除成功"),await w()}function oe(){E.value=void 0,C.value=!0}function ue(a){C.value=!1,a&&w()}const L=r();K(L,a=>{s.value.startClassExpire=a?a[0]:void 0,s.value.endClassExpire=a?a[1]:void 0});const N=r(!1),S=H(),B=r();return qe(()=>{w()}),(a,l)=>{const j=be,h=we,k=Ie,T=$e,U=ze,se=Le,ie=Ne,de=Se,y=Ue,O=Ae,re=De,V=Ee,ce=Be,_e=Oe,pe=Ve,me=Re,b=Fe,fe=Me,ve=Qe,ge=Ye,ke=xe;return d(),c(ke,null,{title:e(()=>[Ze]),default:e(()=>[t(V,{"mb-4":""},{default:e(()=>[t(re,{modal:n(s)},{default:e(()=>[t(U,{gutter:16},{default:e(()=>[t(k,{span:8},{default:e(()=>[t(h,{label:"用户名",name:"userName"},{default:e(()=>[t(j,{value:n(s).userName,"onUpdate:value":l[0]||(l[0]=o=>n(s).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:8},{default:e(()=>[t(h,{label:"邮箱",name:"email"},{default:e(()=>[t(j,{value:n(s).email,"onUpdate:value":l[1]||(l[1]=o=>n(s).email=o)},null,8,["value"])]),_:1})]),_:1}),t(k,{span:8},{default:e(()=>[t(h,{label:"用户等级",name:"grade"},{default:e(()=>[t(T,{value:n(s).grade,"onUpdate:value":l[2]||(l[2]=o=>n(s).grade=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(U,{gutter:16},{default:e(()=>[t(k,{span:8},{default:e(()=>[t(h,{label:"等级到期"},{default:e(()=>[t(se,{value:n(L),"onUpdate:value":l[3]||(l[3]=o=>P(L)?L.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),t(k,{span:8},{default:e(()=>[t(h,{label:"状态",name:"status"},{default:e(()=>[t(de,{value:n(s).status,"onUpdate:value":l[4]||(l[4]=o=>n(s).status=o),"allow-clear":!0},{default:e(()=>[(d(!0),M(Q,null,We(n(W),(o,i)=>(d(),c(ie,{key:i,value:i},{default:e(()=>[u(x(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(k,{span:8},{default:e(()=>[t(h,{label:"分组",name:"group"},{default:e(()=>[t(T,{value:n(s).group,"onUpdate:value":l[5]||(l[5]=o=>n(s).group=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(U,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(k,{span:24},{default:e(()=>[t(O,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(y,{loading:n(ee),type:"primary",onClick:te},{default:e(()=>[u(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t(U,{gutter:24},{default:e(()=>[t(k,{span:24},{default:e(()=>[t(V,{title:"用户列表"},{extra:e(()=>[t(O,{size:24},{default:e(()=>[t(y,{type:"default",onClick:oe},{default:e(()=>[u(" 添加用户 ")]),_:1}),t(me,{title:"列设置"},{default:e(()=>[t(pe,{open:n(A),"onUpdate:open":l[8]||(l[8]=o=>P(A)?A.value=o:null),trigger:"click"},{overlay:e(()=>[t(V,null,{title:e(()=>[t(ce,{checked:n(p).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>n(p).checkAll=o),indeterminate:n(p).indeterminate,onChange:X},{default:e(()=>[u(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[t(y,{type:"link",onClick:Z},{default:e(()=>[u(" 重置 ")]),_:1})]),default:e(()=>[t(_e,{value:n(p).checkList,"onUpdate:value":l[7]||(l[7]=o=>n(p).checkList=o),options:n(q),style:{display:"flex","flex-direction":"column"},onChange:ae},null,8,["value","options"])]),_:1})]),default:e(()=>[t(n(ye))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[t(ve,{loading:n($),columns:n(I),"data-source":n(Y),pagination:n(g),scroll:{x:100}},{bodyCell:e(({column:o,record:i})=>[o.dataIndex==="status"?(d(),M(Q,{key:0},[i.status==="forbidden"?(d(),c(b,{key:0,color:"purple"},{default:e(()=>[u(x(n(m).forbidden),1)]),_:1})):_("",!0),i.status==="excess"?(d(),c(b,{key:1,color:"orange"},{default:e(()=>[u(x(n(m).excess),1)]),_:1})):_("",!0),i.status==="normal"?(d(),c(b,{key:2,color:"cyan"},{default:e(()=>[u(x(n(m).normal),1)]),_:1})):_("",!0),i.status==="paid"?(d(),c(b,{key:3,color:"green"},{default:e(()=>[u(x(n(m).paid),1)]),_:1})):_("",!0),i.status==="expire"?(d(),c(b,{key:4,color:"blue"},{default:e(()=>[u(x(n(m).expire),1)]),_:1})):_("",!0),i.status==="delete"?(d(),c(b,{key:5,color:"red"},{default:e(()=>[u(x(n(m).delete),1)]),_:1})):_("",!0)],64)):_("",!0),o.dataIndex==="classExpire"?(d(),M(Q,{key:1},[u(x(n(Ce)(i.classExpire).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="action"?(d(),c(O,{key:2},{default:e(()=>[t(y,{type:"default",onClick:R=>ne(i)},{default:e(()=>[u(" 修改 ")]),_:2},1032,["onClick"]),t(y,{type:"default",onClick:R=>{B.value=i,N.value=!0,S.value=Ke}},{default:e(()=>[u(" 购买记录 ")]),_:2},1032,["onClick"]),t(y,{type:"default",onClick:R=>{B.value=i,N.value=!0,S.value=Je}},{default:e(()=>[u(" 充值记录 ")]),_:2},1032,["onClick"]),t(fe,{title:"确定要删除用户吗？",onConfirm:R=>le(i.id)},{icon:e(()=>[t(n(he))]),default:e(()=>[t(y,{danger:"",type:"primary"},{default:e(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(ge,{title:"编辑用户",width:720,visible:n(C),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>C.value=!1)},{default:e(()=>[n(C)?(d(),c(G(Te),{key:0,"user-id":n(E),onHandleClose:ue},null,40,["user-id"])):_("",!0)]),_:1},8,["visible"]),n(N)?(d(),c(G(n(S)),{key:0,user:n(B),onClose:l[10]||(l[10]=o=>{N.value=!1,S.value=void 0})},null,40,["user"])):_("",!0)]),_:1})}}});export{rt as default};
