import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-4xCVYPju.js";import{aO as fe,d as ge,aP as ve,K as xe,N as ke,aa as ye,av as he,ab as Ce,aK as be,aI as we,aJ as Ie,S as ze,m as Le,F as Ne,a9 as $e,Q as Ae,aQ as Se,D as Ue,ag as De,a0 as Ee,aw as Be,an as Oe,s as Ve}from"./antd-Ckg-4fVb.js";import{u as Re,_ as Fe,d as Me}from"./edit.vue_vue_type_script_setup_true_lang-B7b653Y2.js";import{u as Qe}from"./index-SCXA_WO_.js";import{d as Ye,f as p,s as je,c as B,r as Q,w as Y,o as Te,a5 as i,ac as c,ad as e,k as t,u as n,H as j,a3 as O,F as V,al as He,G as s,af as k,ag as _,ak as Je,a8 as Ke}from"./vue-CP9fVXMC.js";import"./context-CAil3aop.js";var m=(f=>(f.normal="正常",f.expire="到期",f.excess="超额",f.paid="付费",f.forbidden="禁用",f.delete="注销",f))(m||{});const Pe=Ke("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),tt=Ye({__name:"index",setup(f){const z=p(!1),A=p(!1),S=je([{title:"#",dataIndex:"id"},{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"分组",dataIndex:"group"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",width:200}]),g=B(()=>S.value.map(a=>a.dataIndex)),U=p(),r=Q({indeterminate:!1,checkAll:!0,checkList:g.value}),T=B(()=>S.value.map(a=>a.dataIndex==="action"?{label:a.title,value:a.dataIndex,disabled:!0}:{label:a.title,value:a.dataIndex})),H=B(()=>{const a={};for(const l in m)a[l]=m[l];return a}),R=p(),v=Q({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,l){v.pageSize=l,v.current=a,b()}}),u=p({}),y=p(!1);async function b(){if(!z.value){z.value=!0;try{const{data:a}=await Re({size:v.pageSize,current:v.current,param:u.value});R.value=a.records,v.total=a.total,v.pageSize=a.size,v.current=a.current}finally{z.value=!1}}}function L(a){return S.value.filter(l=>a.includes(l.dataIndex))}const w=p(L(g.value));function J(a){Object.assign(r,{checkList:a.target.checked?g.value:[],indeterminate:!0}),w.value=a.target.checked?L(g.value):w.value.filter(l=>l.dataIndex==="action")}Y(()=>r.checkList,a=>{r.indeterminate=!!a.length&&a.length<g.value.length,r.checkAll=a.length===g.value.length});function K(){r.checkList=g.value,w.value=L(g.value)}const P=p();function G(){b()}function q(a){const l=L(a);w.value=l}function W(a){U.value=a.id,y.value=!0}async function X(a){await Me(a),Qe().success("用户删除成功"),await b()}function Z(){U.value=void 0,y.value=!0}function ee(a){y.value=!1,a&&b()}const N=p();return Y(N,a=>{u.value.startClassExpire=a?a[0]:void 0,u.value.endClassExpire=a?a[1]:void 0}),Te(()=>{b()}),(a,l)=>{const F=xe,h=ke,x=ye,M=he,$=Ce,te=be,ae=we,ne=Ie,I=ze,D=Le,le=Ne,E=$e,oe=Ae,ue=Se,se=Ue,ie=De,C=Ee,de=Be,re=Oe,ce=Ve,_e=me;return i(),c(_e,null,{title:e(()=>[Pe]),default:e(()=>[t(E,{"mb-4":""},{default:e(()=>[t(le,{modal:n(u)},{default:e(()=>[t($,{gutter:16},{default:e(()=>[t(x,{span:8},{default:e(()=>[t(h,{label:"用户名",name:"userName"},{default:e(()=>[t(F,{value:n(u).userName,"onUpdate:value":l[0]||(l[0]=o=>n(u).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(x,{span:8},{default:e(()=>[t(h,{label:"邮箱",name:"email"},{default:e(()=>[t(F,{value:n(u).email,"onUpdate:value":l[1]||(l[1]=o=>n(u).email=o)},null,8,["value"])]),_:1})]),_:1}),t(x,{span:8},{default:e(()=>[t(h,{label:"用户等级",name:"grade"},{default:e(()=>[t(M,{value:n(u).grade,"onUpdate:value":l[2]||(l[2]=o=>n(u).grade=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t($,{gutter:16},{default:e(()=>[t(x,{span:8},{default:e(()=>[t(h,{label:"等级到期"},{default:e(()=>[t(te,{value:n(N),"onUpdate:value":l[3]||(l[3]=o=>j(N)?N.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),t(x,{span:8},{default:e(()=>[t(h,{label:"状态",name:"status"},{default:e(()=>[t(ne,{value:n(u).status,"onUpdate:value":l[4]||(l[4]=o=>n(u).status=o),"allow-clear":!0},{default:e(()=>[(i(!0),O(V,null,He(n(H),(o,d)=>(i(),c(ae,{key:d,value:d},{default:e(()=>[s(k(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(x,{span:8},{default:e(()=>[t(h,{label:"分组",name:"group"},{default:e(()=>[t(M,{value:n(u).group,"onUpdate:value":l[5]||(l[5]=o=>n(u).group=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t($,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(x,{span:24},{default:e(()=>[t(D,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(I,{loading:n(P),type:"primary",onClick:G},{default:e(()=>[s(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t($,{gutter:24},{default:e(()=>[t(x,{span:24},{default:e(()=>[t(E,{title:"用户列表"},{extra:e(()=>[t(D,{size:24},{default:e(()=>[t(I,{type:"default",onClick:Z},{default:e(()=>[s(" 添加用户 ")]),_:1}),t(ie,{title:"列设置"},{default:e(()=>[t(se,{open:n(A),"onUpdate:open":l[8]||(l[8]=o=>j(A)?A.value=o:null),trigger:"click"},{overlay:e(()=>[t(E,null,{title:e(()=>[t(oe,{checked:n(r).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>n(r).checkAll=o),indeterminate:n(r).indeterminate,onChange:J},{default:e(()=>[s(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[t(I,{type:"link",onClick:K},{default:e(()=>[s(" 重置 ")]),_:1})]),default:e(()=>[t(ue,{value:n(r).checkList,"onUpdate:value":l[7]||(l[7]=o=>n(r).checkList=o),options:n(T),style:{display:"flex","flex-direction":"column"},onChange:q},null,8,["value","options"])]),_:1})]),default:e(()=>[t(n(fe))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[t(re,{loading:n(z),columns:n(w),"data-source":n(R),pagination:n(v),scroll:{x:100}},{bodyCell:e(({column:o,record:d})=>[o.dataIndex==="status"?(i(),O(V,{key:0},[d.status==="forbidden"?(i(),c(C,{key:0,color:"purple"},{default:e(()=>[s(k(n(m).forbidden),1)]),_:1})):_("",!0),d.status==="excess"?(i(),c(C,{key:1,color:"orange"},{default:e(()=>[s(k(n(m).excess),1)]),_:1})):_("",!0),d.status==="normal"?(i(),c(C,{key:2,color:"cyan"},{default:e(()=>[s(k(n(m).normal),1)]),_:1})):_("",!0),d.status==="paid"?(i(),c(C,{key:3,color:"green"},{default:e(()=>[s(k(n(m).paid),1)]),_:1})):_("",!0),d.status==="expire"?(i(),c(C,{key:4,color:"blue"},{default:e(()=>[s(k(n(m).expire),1)]),_:1})):_("",!0),d.status==="delete"?(i(),c(C,{key:5,color:"red"},{default:e(()=>[s(k(n(m).delete),1)]),_:1})):_("",!0)],64)):_("",!0),o.dataIndex==="classExpire"?(i(),O(V,{key:1},[s(k(n(ge)(d.classExpire).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="action"?(i(),c(D,{key:2},{default:e(()=>[t(I,{type:"default",onClick:pe=>W(d)},{default:e(()=>[s(" 修改 ")]),_:2},1032,["onClick"]),t(de,{title:"确定要删除用户吗？",onConfirm:pe=>X(d.id)},{icon:e(()=>[t(n(ve))]),default:e(()=>[t(I,{danger:"",type:"primary"},{default:e(()=>[s(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(ce,{title:"编辑用户",width:720,visible:n(y),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>y.value=!1)},{default:e(()=>[n(y)?(i(),c(Je(Fe),{key:0,"user-id":n(U),onHandleClose:ee},null,40,["user-id"])):_("",!0)]),_:1},8,["visible"])]),_:1})}}});export{tt as default};
