import{_ as P}from"./index.vue_vue_type_script_setup_true_lang-CWrsniDz.js";import{aI as q,S as M,d as G,K as H,N as Q,aa as W,aJ as X,aK as Z,ab as ee,aL as te,m as ae,F as ne,a9 as oe,an as se,am as ue}from"./antd-BeZGkD-C.js";import{_ as le}from"./detail.vue_vue_type_script_setup_true_lang-Uaf6zK6h.js";import{a as ie,b as de,B as $,_ as re}from"./refund.vue_vue_type_script_setup_true_lang-Bc0PacU_.js";import{d as R,a5 as d,ac as v,ad as e,G as p,ag as g,f,r as pe,w as _e,c as me,o as ce,k as t,u as s,a3 as S,F as I,al as fe,af as h,H as F,ak as ge,a8 as ve}from"./vue-CP9fVXMC.js";import"./index-C8fbnVQu.js";import"./context-BFpfsoUs.js";import"./shop-CnUEuO3f.js";const ye=R({__name:"active",props:{buttonType:{type:String,default:"primary"},danger:{type:Boolean,default:!1},message:{type:String,default:"套餐激活成功"},bought:{type:Object,required:!0}},emits:["on-active"],setup(y,{emit:_}){const C=_,b=y;async function i(){const{id:u,userid:m}=b.bought;await ie(m,u),q.success(b.message),C("on-active",!0)}return(u,m)=>{const r=M;return y.bought.status==="no_use"?(d(),v(r,{key:0,danger:y.danger,type:y.buttonType,onClick:i},{default:e(()=>[p(" 激活 ")]),_:1},8,["danger","type"])):g("",!0)}}}),be=ve("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录管理",-1),ze=R({__name:"index",setup(y){const _=f(!1),C=f([{title:"#",dataIndex:"id"},{title:"商品名",dataIndex:"shopName"},{title:"购买日期",dataIndex:"datetime"},{title:"自动续费",dataIndex:"renew"},{title:"价格",dataIndex:"price"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action"}]),b=f(),i=pe({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,n){i.pageSize=n,i.current=a,m()}}),u=f({});async function m(){if(!_.value){_.value=!0;try{const{data:a}=await de({size:i.pageSize,current:i.current,param:u.value});b.value=a.records,i.total=a.total,i.pageSize=a.size,i.current=a.current}finally{_.value=!1}}}const r=f(!1),z=f(0);function V(a){r.value=!0,z.value=a.snapshotId}const k=f();_e(k,a=>{u.value.startDateTime=a?a[0]:void 0,u.value.endDateTime=a?a[1]:void 0});const Y=me(()=>{const a={};for(const n in $)a[n]=$[n];return a});function j(a){a&&m()}return ce(()=>{m()}),(a,n)=>{const B=H,x=Q,c=W,N=X,D=Z,w=ee,A=te,T=M,U=ae,E=ne,O=oe,J=se,K=ue,L=P;return d(),v(L,null,{title:e(()=>[be]),default:e(()=>[t(O,{"mb-4":""},{default:e(()=>[t(E,{modal:s(u)},{default:e(()=>[t(w,{gutter:16},{default:e(()=>[t(c,{span:8},{default:e(()=>[t(x,{label:"用户名",name:"userName"},{default:e(()=>[t(B,{value:s(u).userName,"onUpdate:value":n[0]||(n[0]=o=>s(u).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"商品名",name:"shopName"},{default:e(()=>[t(B,{value:s(u).shopName,"onUpdate:value":n[1]||(n[1]=o=>s(u).shopName=o)},null,8,["value"])]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"购买状态",name:"boughtStatus"},{default:e(()=>[t(D,{value:s(u).boughtStatus,"onUpdate:value":n[2]||(n[2]=o=>s(u).boughtStatus=o)},{default:e(()=>[(d(!0),S(I,null,fe(s(Y),(o,l)=>(d(),v(N,{key:l,value:l},{default:e(()=>[p(h(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(w,{gutter:16},{default:e(()=>[t(c,{span:8},{default:e(()=>[t(x,{label:"购买日期"},{default:e(()=>[t(A,{value:s(k),"onUpdate:value":n[3]||(n[3]=o=>F(k)?k.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),t(c,{span:8},{default:e(()=>[t(x,{label:"自动续期",name:"renew"},{default:e(()=>[t(D,{value:s(u).renew,"onUpdate:value":n[4]||(n[4]=o=>s(u).renew=o),"allow-clear":!0},{default:e(()=>[t(N,{value:1},{default:e(()=>[p(" 开启 ")]),_:1}),t(N,{value:0},{default:e(()=>[p(" 关闭 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(w,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(c,{span:24},{default:e(()=>[t(U,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(T,{loading:s(_),type:"primary",onClick:m},{default:e(()=>[p(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t(w,{gutter:16},{default:e(()=>[t(c,{span:24},{default:e(()=>[t(O,{title:"购买记录"},{default:e(()=>[t(J,{loading:s(_),columns:s(C),"data-source":s(b),pagination:s(i),scroll:{x:100}},{bodyCell:e(({column:o,record:l})=>[o.dataIndex==="shopName"?(d(),v(T,{key:0,type:"link",onClick:xe=>V(l)},{default:e(()=>[p(h(l.shopName),1)]),_:2},1032,["onClick"])):g("",!0),o.dataIndex==="datetime"?(d(),S(I,{key:1},[p(h(s(G)(l.datetime).format("YYYY-MM-DD")),1)],64)):g("",!0),o.dataIndex==="renew"?(d(),S(I,{key:2},[p(h(l.renew?"开启":"关闭"),1)],64)):g("",!0),o.dataIndex==="status"?(d(),S(I,{key:3},[p(h(s($)[l.status]),1)],64)):g("",!0),o.dataIndex==="action"?(d(),v(U,{key:4},{default:e(()=>[t(ye,{bought:l},null,8,["bought"]),t(re,{"bought-id":l.id,visible:!["invalid","refund"].includes(l.status),onOnClose:j},null,8,["bought-id","visible"])]),_:2},1024)):g("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(K,{open:s(r),"onUpdate:open":n[5]||(n[5]=o=>F(r)?r.value=o:null),width:"800px",title:"详情",onCancel:n[6]||(n[6]=o=>r.value=!1),onOk:n[7]||(n[7]=o=>r.value=!1)},{default:e(()=>[s(r)?(d(),v(ge(le),{key:0,"snapshot-id":s(z)},null,8,["snapshot-id"])):g("",!0)]),_:1},8,["open"])]),_:1})}}});export{ze as default};
