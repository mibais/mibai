import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-Dx9lCvpi.js";import{b6 as H,d as N,b7 as J,b8 as P,a9 as Q,aa as q,ab as L,S as W,m as X,an as Z,am as tt}from"./antd-BJOCYv9d.js";import{d as et,B as h,_ as at,r as nt}from"./refund.vue_vue_type_script_setup_true_lang-_i8sBn2i.js";import{_ as ot}from"./detail.vue_vue_type_script_setup_true_lang-FByi6gN0.js";import{_ as st}from"./auto_renew.vue_vue_type_script_setup_true_lang-BfDiQto8.js";import{a as it,_ as lt}from"./index-BpaNj_go.js";import{d as ut,f as _,r as dt,o as _t,a5 as d,ac as v,ad as t,k as n,u as o,H as M,G as r,af as x,ag as c,a3 as S,F as b,ak as ct,a6 as rt,a7 as pt,a8 as p}from"./vue-CP9fVXMC.js";import"./context-CScehHMP.js";import"./shop-Xt-b-B1O.js";const y=m=>(rt("data-v-6b25c458"),m=m(),pt(),m),mt=y(()=>p("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录",-1)),ft=y(()=>p("p",null,"购买记录自失效后保留7天。失效指退款、过期等无效状态。",-1)),gt=y(()=>p("p",null,"多次购买套餐不会覆盖，套餐处于未使用状态。未使用的套餐将在前一个套餐到期后自动使用。",-1)),ht=y(()=>p("p",null,[r("退款的款项只回到账户"),p("a",{href:"code"},"钱包"),r("中，无法原路退款到付款方")],-1)),vt=ut({__name:"index",setup(m){const u=_(!1),C=_(0),f=_(!1),T=[{title:"商品名",dataIndex:"shopName",width:120},{title:"价格",dataIndex:"price",width:40},{title:"购买时间",dataIndex:"datetime",width:40},{title:"状态",dataIndex:"status",width:40},{title:"续费时间",dataIndex:"renewTime",width:80},{title:"操作",dataIndex:"action",width:120}],$=_([]),z=_(),l=dt({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`${e}条记录`,onChange(e,s){l.pageSize=s,l.current=e,g()}});async function g(){if(!f.value){f.value=!0;try{const{data:e}=await et({size:l.pageSize,current:l.current});$.value=e.records,l.total=e.total,l.pageSize=e.size,l.current=e.current}finally{f.value=!1}}}async function O(e){u.value=!0,C.value=e.snapshotId}const w=_(["1"]);async function R(){const{data:e}=await nt();z.value=e}async function K(e){e&&(await g(),await it().getUserInfo())}return _t(()=>{g(),R()}),(e,s)=>{const k=J,U=P,D=Q,Y=q,B=L,V=W,A=X,F=Z,j=tt,E=G;return d(),v(E,null,{title:t(()=>[mt]),content:t(()=>[n(B,{gutter:24},{default:t(()=>[n(Y,{span:24},{default:t(()=>[n(D,{title:"提示"},{default:t(()=>[n(U,{activeKey:o(w),"onUpdate:activeKey":s[0]||(s[0]=a=>M(w)?w.value=a:null),bordered:!1,ghost:""},{expandIcon:t(a=>[n(o(H),{rotate:a!=null&&a.isActive?90:0},null,8,["rotate"])]),default:t(()=>[n(k,{key:"1",header:"购买记录保留几天",class:"triangle"},{default:t(()=>[ft]),_:1}),n(k,{key:"2",header:"关于多次购买",class:"triangle"},{default:t(()=>[gt]),_:1}),n(k,{key:"3",header:"关于退款",class:"triangle"},{default:t(()=>[ht]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})]),_:1}),n(B,{gutter:24,"mt-5":""},{default:t(()=>[n(Y,{span:24},{default:t(()=>[n(D,{title:"购买明细"},{default:t(()=>[n(F,{loading:o(f),columns:T,"data-source":o($),pagination:o(l)},{bodyCell:t(({column:a,record:i})=>[a.dataIndex==="shopName"?(d(),v(V,{key:0,type:"link",onClick:I=>O(i)},{default:t(()=>[r(x(i.shopName),1)]),_:2},1032,["onClick"])):c("",!0),a.dataIndex==="status"?(d(),S(b,{key:1},[r(x(o(h)[i.status]),1)],64)):c("",!0),a.dataIndex==="datetime"?(d(),S(b,{key:2},[r(x(o(N)(i.datetime).format("YYYY-MM-DD")),1)],64)):c("",!0),a.dataIndex==="renewTime"?(d(),S(b,{key:3},[r(x(i.renewTime?o(N)(i.renewTime).format("YYYY-MM-DD"):"不自动续费"),1)],64)):c("",!0),a.dataIndex==="action"?(d(),v(A,{key:4},{default:t(()=>{var I;return[n(st,{bought:i,onOnChange:g},null,8,["bought"]),n(at,{danger:"",visible:((I=o(z))==null?void 0:I.allowRefund)&&[o(h).using,o(h).no_use].includes(o(h)[i.status]),bought:i,onOnClose:K},null,8,["visible","bought"])]}),_:2},1024)):c("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1})]),_:1})]),_:1})]),default:t(()=>[n(j,{open:o(u),"onUpdate:open":s[1]||(s[1]=a=>M(u)?u.value=a:null),width:"800px",title:"详情",onCancel:s[2]||(s[2]=a=>u.value=!1),onOk:s[3]||(s[3]=a=>u.value=!1)},{default:t(()=>[o(u)?(d(),v(ct(ot),{key:0,"snapshot-id":o(C)},null,8,["snapshot-id"])):c("",!0)]),_:1},8,["open"])]),_:1})}}}),zt=lt(vt,[["__scopeId","data-v-6b25c458"]]);export{zt as default};
