import{_ as Z}from"./coupon.vue_vue_type_script_setup_true_lang-C9N4ayEy.js";import{v as ee,h as te}from"./shop-DaZxHBIe.js";import{P as ne}from"./alipay-qrcode.vue_vue_type_script_setup_true_lang-CdmVIqF5.js";import{p as oe}from"./paymentMap-rcd-qn9f.js";import{d as G,a5 as i,a3 as g,k as t,ad as e,U as z,a8 as f,af as _,F as D,aq as ae,f as c,c as q,o as se,ac as P,G as u,u as n,ag as le,al as W,ak as ue,H as E,a6 as pe,a7 as ie}from"./vue-DIvP5FMT.js";import{az as re,ab as ce,aa as _e,b3 as de,b4 as me,b5 as fe,b6 as ye,ar as ve,S as be,J as ge,m as Ce,aS as we,ao as he,aM as xe,aN as ke,am as Pe}from"./antd-ClWK_BPx.js";import{a as Se,u as $e,_ as Be}from"./index-E9vVtGBC.js";const Ie={class:"text-muted"},S=G({__name:"title-button",props:{help:{type:String,default:""}},setup(d){return(y,R)=>{const $=re,C=ce,v=_e;return i(),g(D,null,[t(C,{"mt-5":""},{default:e(()=>[t($,{level:5},{default:e(()=>[z(y.$slots,"titlePrefix"),z(y.$slots,"title")]),_:3})]),_:3}),t(C,{"mt-2":""},{default:e(()=>[t(v,null,{default:e(()=>[z(y.$slots,"default")]),_:3}),t(v,{span:24},{default:e(()=>[f("p",Ie,_(d.help),1)]),_:1})]),_:3})],64)}}}),Te=d=>(pe("data-v-a210ab84"),d=d(),ie(),d),Me=Te(()=>f("ul",null,[f("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),f("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),Ne={key:0},Fe={key:1},ze=G({__name:"buy",props:{coverId:{type:Number,required:!0}},emits:["closeBuy"],setup(d,{emit:y}){const R=d,$=y,C=ae(),v=c(""),m=c(-1),l=c(),U=c(!0),b=c(!1),B=c(ne.alipay),I=c(),w=Se(),V=$e(),T={color:"#FF7200",fontWeight:"bold"};async function H(){var o;const{data:p}=await ee(R.coverId);I.value=p,U.value=!1,l.value=(o=I.value)==null?void 0:o.shopList[0]}const A=q(()=>{var o,x;if(!l.value)return null;const p=m.value>=0?m.value:(o=l.value)==null?void 0:o.price;return w.userInfo.money>=p?p:(x=w.userInfo)==null?void 0:x.money}),M=q(()=>{var o;if(!A.value)return null;const p=m.value>=0?m.value:(o=l.value)==null?void 0:o.price;return Math.max(0,p-A.value).toFixed(2)}),h=c(!1);async function J(){if(M.value<=0)return L();h.value=!0}async function O(p){p&&await L()}async function L(){if(!l.value)return V.error("请选择套餐时长");await te({coupon:v.value,shopId:l.value.id,autoRenew:b.value}),V.success("购买成功o(*￣▽￣*)ブ"),await C.push({path:"/bought/pay-success",replace:!0})}return se(()=>{H()}),(p,o)=>{const x=ve,k=be,j=ge,N=Ce,K=we,Q=he,F=xe,X=ke,Y=Pe;return i(),P(Y,{width:"700px",title:"选择套餐",open:!0,onCancel:o[5]||(o[5]=a=>$("closeBuy"))},{footer:e(()=>[t(x,null,{default:e(()=>[u("还需支付 "),f("span",{style:T},_(n(M))+"元",1)]),_:1}),t(k,{"ml-3":"",key:"submit",type:"primary",onClick:J},{default:e(()=>[u("购买")]),_:1})]),default:e(()=>[["excess","paid"].includes(n(w).userInfo.status)?(i(),P(j,{key:0,message:"请注意",description:"你有套餐正在使用中，本次购买的套餐将不会立即生效。如有需要可在购买成功后前往购买记录页退款不需要的套餐",type:"warning","close-text":"知道了","show-icon":""})):le("",!0),t(S,null,{title:e(()=>[u(" 选择时长")]),titlePrefix:e(()=>[t(n(de),{"two-tone-color":"#eb2f96",closable:""})]),default:e(()=>[t(K,{spinning:n(U)},{default:e(()=>[t(N,{size:[24,16],wrap:""},{default:e(()=>{var a;return[(i(!0),g(D,null,W((a=n(I))==null?void 0:a.shopList,s=>{var r;return i(),P(k,{key:s.id,type:((r=n(l))==null?void 0:r.id)===s.id?"primary":"default",class:"buyButton",onClick:De=>l.value=s},{default:e(()=>[u(_(s.content.expire===0?"长期":`${s.content.expire}天`),1)]),_:2},1032,["type","onClick"])}),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),t(S,{help:"* 如开启自动续费，请确保账号余额充足"},{title:e(()=>[u(" 自动续费")]),titlePrefix:e(()=>[t(n(me),{"two-tone-color":"#52c41a"})]),default:e(()=>[t(N,{size:16},{default:e(()=>{var a,s;return[t(k,{disabled:((a=n(l))==null?void 0:a.content.expire)===0,class:"buyButton",type:n(b)?"primary":"default",onClick:o[0]||(o[0]=r=>b.value=!0)},{default:e(()=>[u(" 开启 ")]),_:1},8,["disabled","type"]),t(k,{disabled:((s=n(l))==null?void 0:s.content.expire)===0,class:"buyButton",type:n(b)?"default":"primary",onClick:o[1]||(o[1]=r=>b.value=!1)},{default:e(()=>[u(" 关闭 ")]),_:1},8,["disabled","type"])]}),_:1})]),_:1}),t(S,{help:"* 默认抵扣账户余额"},{title:e(()=>[u(" 支付方式")]),titlePrefix:e(()=>[t(n(fe))]),default:e(()=>[t(N,{size:20},{default:e(()=>[(i(!0),g(D,null,W(n(oe),(a,s)=>(i(),P(ue(a),{key:s,payClient:n(B),"onUpdate:payClient":o[2]||(o[2]=r=>E(B)?B.value=r:null),open:n(h),"onUpdate:open":o[3]||(o[3]=r=>E(h)?h.value=r:null),payPrice:n(M),onClose:O},null,40,["payClient","open","payPrice"]))),128))]),_:1})]),_:1}),t(S,null,{title:e(()=>[u(" 购买须知")]),titlePrefix:e(()=>[t(n(ye))]),default:e(()=>[t(Q,null,{default:e(()=>[Me]),_:1})]),_:1}),t(X,{"mb-8":"",bordered:"",title:"支付明细"},{extra:e(()=>{var a;return[t(Z,{"shop-id":(a=n(l))==null?void 0:a.id,onApplyCoupon:o[4]||(o[4]=s=>{v.value=s.couponCode,m.value=s.discountedPrice})},null,8,["shop-id"])]}),default:e(()=>[t(F,{label:"商品名称","content-style":{fontWeight:"bold"},span:3},{default:e(()=>{var a;return[u(_((a=n(l))==null?void 0:a.name),1)]}),_:1}),t(F,{"content-style":T,label:"总价"},{default:e(()=>{var a,s;return[n(m)>=0?(i(),g("span",Ne,[u(_(n(m))+"元 ",1),f("del",null,_((a=n(l))==null?void 0:a.price)+"元",1)])):(i(),g("span",Fe,_((s=n(l))==null?void 0:s.price)+"元 ",1))]}),_:1}),t(F,{"content-style":T,label:"账户余额"},{default:e(()=>{var a;return[u(_((a=n(w).userInfo)==null?void 0:a.money)+"元",1)]}),_:1})]),_:1})]),_:1})}}}),Ee=Be(ze,[["__scopeId","data-v-a210ab84"]]);export{Ee as default};
