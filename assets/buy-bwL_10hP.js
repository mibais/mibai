import{d as Y,aq as Z,f as _,c as z,s as ee,o as te,a5 as m,ac as C,ad as t,k as a,u as e,G as i,ak as ae,ag as q,a3 as P,F as L,al as se,af as v,a8 as s,m as oe,A as ne,a6 as le,a7 as ue}from"./vue-CP9fVXMC.js";import{_ as ce}from"./coupon.vue_vue_type_script_setup_true_lang-FrFehCC9.js";import{v as ie,h as re}from"./shop-DC6f4ZPB.js";import{P as T}from"./alipay-qrcode.vue_vue_type_script_setup_true_lang-BHM5mzLO.js";import{p as pe}from"./paymentMap-BiNUNeRv.js";import{a as de,u as _e,_ as me}from"./index-yQqClIEh.js";import{b0 as ve,b1 as fe,b2 as ye,b3 as be,b4 as he,S as xe,J as Ce,m as we,aS as ge,a9 as ke,aa as Be,aH as Se,ab as Ie,am as Pe}from"./antd-BeZGkD-C.js";const u=f=>(le("data-v-1c427887"),f=f(),ue(),f),Te=u(()=>s("p",{class:"text-muted"}," * 如开启自动续费，请确保账号余额充足 ",-1)),$e=u(()=>s("p",{class:"text-muted"}," * 默认抵扣账户余额 ",-1)),Ae=u(()=>s("ul",null,[s("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),s("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),Me={class:"invoice-box"},Ne=u(()=>s("span",{class:"text-muted"},"商品名称",-1)),De=u(()=>s("br",null,null,-1)),Fe={class:"invoice-value"},Re={class:"invoice-box"},Ve=u(()=>s("span",{class:"text-muted"},"总价",-1)),ze=u(()=>s("br",null,null,-1)),qe={class:"invoice-value"},Le={key:0},Ee={class:"invoice-box"},Ge=u(()=>s("span",{class:"text-muted"},"账户余额",-1)),He=u(()=>s("br",null,null,-1)),Je={class:"invoice-value"},Ue={class:"invoice-box"},je=u(()=>s("span",{class:"text-muted"},"还需要支付",-1)),Ke=u(()=>s("br",null,null,-1)),Oe={class:"invoice-value"},Qe=Y({__name:"buy",props:{coverId:{type:Number,required:!0}},emits:["closeBuy"],setup(f,{emit:E}){const G=f,H=E,J=Z(),$=_(""),p=_(),l=_(),A=_(!0),y=_(!1),w=_(T.alipay),M=_(),h=de(),N=_e();async function U(){const{data:r}=await ie(G.coverId);M.value=r,A.value=!1}const D=z(()=>{var o,d;if(!l.value)return null;const r=p.value?p.value:(o=l.value)==null?void 0:o.price;return h.userInfo.money>=r?r:(d=h.userInfo)==null?void 0:d.money}),g=z(()=>{var o;if(!D.value)return null;const r=p.value?p.value:(o=l.value)==null?void 0:o.price;return Math.max(0,r-D.value).toFixed(2)}),k=ee(),B=_(!1);async function j(){if(g.value<=0)return F();k.value=pe[w.value],B.value=!0}async function K(r){B.value=!1,k.value=void 0,r&&await F()}async function F(){if(!l.value)return N.error("请选择套餐时长");await re({coupon:$.value,shopId:l.value.id,autoRenew:y.value}),N.success("购买成功o(*￣▽￣*)ブ"),await J.push({path:"/bought/pay-success",replace:!0})}return te(()=>{U()}),(r,o)=>{const d=xe,O=Ce,S=we,Q=ge,x=ke,R=Be,W=Se,V=Ie,X=Pe;return m(),C(X,{width:"700px",title:"购买页",open:!0,onCancel:o[4]||(o[4]=n=>H("closeBuy"))},{footer:t(()=>{var n;return[a(ce,{"shop-id":(n=e(l))==null?void 0:n.id,onApplyCoupon:o[0]||(o[0]=c=>{$.value=c.couponCode,p.value=c.discountedPrice})},null,8,["shop-id"]),a(d,{key:"submit",type:"primary",onClick:j},{default:t(()=>[i(" 购买 ")]),_:1})]}),default:t(()=>[e(B)?(m(),C(ae(e(k)),{key:0,"pay-price":e(g),onClose:K},null,40,["pay-price"])):q("",!0),["excess","paid"].includes(e(h).userInfo.status)?(m(),C(O,{key:1,message:"请注意",description:"已有套餐正在使用中，因此本次购买的套餐将不会立即生效。如有需要可在购买成功后根据系统提示前往购买记录页进行后续操作",type:"warning","close-text":"知道了","show-icon":""})):q("",!0),a(x,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(ve),{"two-tone-color":"#eb2f96",closable:""}),i(" 选择时长 ")]),default:t(()=>[a(Q,{spinning:e(A)},{default:t(()=>[a(S,{size:[40,16],wrap:""},{default:t(()=>{var n;return[(m(!0),P(L,null,se((n=e(M))==null?void 0:n.shopList,c=>{var b;return m(),C(d,{key:c.id,type:((b=e(l))==null?void 0:b.id)===c.id?"primary":"default",class:"buyButton",onClick:I=>l.value=c},{default:t(()=>[i(v(c.content.expire)+"天 ",1)]),_:2},1032,["type","onClick"])}),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),a(x,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(fe),{"two-tone-color":"#52c41a"}),i(" 自动续费 ")]),default:t(()=>[a(S,{size:20},{default:t(()=>[a(d,{class:"buyButton",type:e(y)?"primary":"default",onClick:o[1]||(o[1]=n=>y.value=!0)},{default:t(()=>[i(" 开启 ")]),_:1},8,["type"]),a(d,{class:"buyButton",type:e(y)?"default":"primary",onClick:o[2]||(o[2]=n=>y.value=!1)},{default:t(()=>[i(" 关闭 ")]),_:1},8,["type"])]),_:1}),Te]),_:1}),a(x,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(ye)),i(" 支付方式 ")]),default:t(()=>[a(S,{size:20},{default:t(()=>[a(d,{class:"payButton",type:e(w)===e(T).alipay?"primary":"default",onClick:o[3]||(o[3]=n=>w.value=e(T).alipay)},{icon:t(()=>[a(e(be))]),default:t(()=>[i(" 支付宝 ")]),_:1},8,["type"])]),_:1}),$e]),_:1}),a(V,{gutter:24},{default:t(()=>[a(R,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:16},xl:{span:16}},{default:t(()=>[a(x,{bordered:!1},{title:t(()=>[a(e(he)),i(" 购买须知 ")]),default:t(()=>[Ae]),_:1})]),_:1}),a(R,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:8},xl:{span:8}},{default:t(()=>[a(W,{vertical:""},{default:t(()=>{var n,c,b,I;return[s("div",Me,[Ne,De,s("span",Fe,v((n=e(l))==null?void 0:n.name),1)]),s("div",Re,[Ve,ze,oe(s("span",{class:"invoice-value discounted-invoice-value"}," ￥ "+v(e(p)),513),[[ne,e(p)]]),s("span",qe,[e(p)?(m(),P("del",Le," ￥ "+v((c=e(l))==null?void 0:c.price),1)):(m(),P(L,{key:1},[i(" ￥ "+v((b=e(l))==null?void 0:b.price),1)],64))])]),s("div",Ee,[Ge,He,s("span",Je,"￥ "+v((I=e(h).userInfo)==null?void 0:I.money),1)]),s("div",Ue,[je,Ke,s("span",Oe,"￥ "+v(e(g)),1)])]}),_:1})]),_:1})]),_:1}),a(V,{style:{marginBottom:"50px"}})]),_:1})}}}),st=me(Qe,[["__scopeId","data-v-1c427887"]]);export{st as default};
