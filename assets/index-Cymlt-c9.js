import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-DbQh5QAG.js";import{d as H,K as L,N as Q,aa as q,aI as W,aJ as X,ab as Z,aK as ee,S as ae,m as te,F as ne,a9 as oe,an as se,am as le}from"./antd-BBX7OAHx.js";import{_ as ue}from"./detail.vue_vue_type_script_setup_true_lang-Cn-ydicq.js";import{b as ie,B as S,a as de}from"./bought-B_aTuobE.js";import{_ as _e}from"./index.vue_vue_type_script_setup_true_lang-CzRArotG.js";import{u as pe}from"./index-skrWRMkq.js";import{d as re,f as m,r as me,w as ce,c as fe,o as ge,a5 as i,ac as f,ad as e,k as a,u as s,a3 as h,F as w,al as ve,G as d,af as k,H as M,ag as c,ak as ke,a8 as xe}from"./vue-CP9fVXMC.js";import"./context-BB3-u6iT.js";import"./shop-nXjpJehg.js";const ye=xe("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录管理",-1),Be=re({__name:"index",setup(be){const g=m(!1),T=m([{title:"#",dataIndex:"id"},{title:"商品名",dataIndex:"shopName"},{title:"购买日期",dataIndex:"datetime"},{title:"自动续费",dataIndex:"renew"},{title:"价格",dataIndex:"price"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action"}]),N=m(),_=me({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`${t}条记录`,onChange(t,n){_.pageSize=n,_.current=t,x()}}),l=m({});async function x(){if(!g.value){g.value=!0;try{const{data:t}=await ie({size:_.pageSize,current:_.current,param:l.value});N.value=t.records,_.total=t.total,_.pageSize=t.size,_.current=t.current}finally{g.value=!1}}}const p=m(!1),$=m(0),F=pe();function O(t){p.value=!0,$.value=t.snapshotId}const y=m();ce(y,t=>{l.value.startDateTime=t?t[0]:void 0,l.value.endDateTime=t?t[1]:void 0});const R=fe(()=>{const t={};for(const n in S)t[n]=S[n];return t});async function V(t){await de(t.userid,t.id),F.success("套餐激活成功")}function Y(t){t&&x()}return ge(()=>{x()}),(t,n)=>{const z=L,v=Q,r=q,I=W,D=X,b=Z,P=ee,C=ae,B=te,j=ne,U=oe,A=se,E=le,J=G;return i(),f(J,null,{title:e(()=>[ye]),default:e(()=>[a(U,{"mb-4":""},{default:e(()=>[a(j,{modal:s(l)},{default:e(()=>[a(b,{gutter:16},{default:e(()=>[a(r,{span:8},{default:e(()=>[a(v,{label:"用户名",name:"userName"},{default:e(()=>[a(z,{value:s(l).userName,"onUpdate:value":n[0]||(n[0]=o=>s(l).userName=o)},null,8,["value"])]),_:1})]),_:1}),a(r,{span:8},{default:e(()=>[a(v,{label:"商品名",name:"shopName"},{default:e(()=>[a(z,{value:s(l).shopName,"onUpdate:value":n[1]||(n[1]=o=>s(l).shopName=o)},null,8,["value"])]),_:1})]),_:1}),a(r,{span:8},{default:e(()=>[a(v,{label:"购买状态",name:"boughtStatus"},{default:e(()=>[a(D,{value:s(l).boughtStatus,"onUpdate:value":n[2]||(n[2]=o=>s(l).boughtStatus=o)},{default:e(()=>[(i(!0),h(w,null,ve(s(R),(o,u)=>(i(),f(I,{key:u,value:u},{default:e(()=>[d(k(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(b,{gutter:16},{default:e(()=>[a(r,{span:8},{default:e(()=>[a(v,{label:"购买日期"},{default:e(()=>[a(P,{value:s(y),"onUpdate:value":n[3]||(n[3]=o=>M(y)?y.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),a(r,{span:8},{default:e(()=>[a(v,{label:"自动续期",name:"renew"},{default:e(()=>[a(D,{value:s(l).renew,"onUpdate:value":n[4]||(n[4]=o=>s(l).renew=o),"allow-clear":!0},{default:e(()=>[a(I,{value:1},{default:e(()=>[d(" 开启 ")]),_:1}),a(I,{value:0},{default:e(()=>[d(" 关闭 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(b,{span:24,style:{"text-align":"right"}},{default:e(()=>[a(r,{span:24},{default:e(()=>[a(B,{flex:"","justify-end":"","w-full":""},{default:e(()=>[a(C,{loading:s(g),type:"primary",onClick:x},{default:e(()=>[d(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),a(b,{gutter:16},{default:e(()=>[a(r,{span:24},{default:e(()=>[a(U,{title:"购买记录"},{default:e(()=>[a(A,{loading:s(g),columns:s(T),"data-source":s(N),pagination:s(_),scroll:{x:100}},{bodyCell:e(({column:o,record:u})=>[o.dataIndex==="shopName"?(i(),f(C,{key:0,type:"link",onClick:K=>O(u)},{default:e(()=>[d(k(u.shopName),1)]),_:2},1032,["onClick"])):c("",!0),o.dataIndex==="datetime"?(i(),h(w,{key:1},[d(k(s(H)(u.datetime).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="renew"?(i(),h(w,{key:2},[d(k(u.renew?"开启":"关闭"),1)],64)):c("",!0),o.dataIndex==="status"?(i(),h(w,{key:3},[d(k(s(S)[u.status]),1)],64)):c("",!0),o.dataIndex==="action"?(i(),f(B,{key:4},{default:e(()=>[u.status==="no_use"?(i(),f(C,{key:0,type:"primary",onClick:K=>V(u)},{default:e(()=>[d(" 激活 ")]),_:2},1032,["onClick"])):c("",!0),a(_e,{"bought-id":u.id,visible:!["invalid","refund"].includes(u.status),onOnClose:Y},null,8,["bought-id","visible"])]),_:2},1024)):c("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),a(E,{open:s(p),"onUpdate:open":n[5]||(n[5]=o=>M(p)?p.value=o:null),width:"800px",title:"详情",onCancel:n[6]||(n[6]=o=>p.value=!1),onOk:n[7]||(n[7]=o=>p.value=!1)},{default:e(()=>[s(p)?(i(),f(ke(ue),{key:0,"snapshot-id":s($)},null,8,["snapshot-id"])):c("",!0)]),_:1},8,["open"])]),_:1})}}});export{Be as default};
