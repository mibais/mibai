import{v as y,a as N}from"./index-BfKtmSYb.js";import{d as w,a5 as S,a3 as h,s as q,f as d,o as E,k as o,ad as m,u as v,F as R}from"./vue-CP9fVXMC.js";import{J as A,aG as C,aU as D,at as I}from"./antd-BiDZImxE.js";var f=(a=>(a.alipay="alipay",a))(f||{});function O(a){return y("/payment/process",a,{customDev:!0})}function $(a){return y("/payment/payStatus",{tradeNo:a},{customDev:!0})}function B(a){return y("/payment/createOrder",a,{customDev:!0})}const F=w({__name:"index",emits:["receiveMsg"],setup(a,{expose:l,emit:n}){const c=n;async function i(r){var t;if(window.EventSource){const _=(t=N().userInfo)==null?void 0:t.id,p=new EventSource(`http://127.0.0.1:8080/api/sse/create/chargeEvent?tradeNo=${r}&userId=${_}`);p.onmessage=function(s){s.data&&c("receiveMsg",s.data)},p.onerror=s=>{}}}return l({createSse:i}),(r,t)=>(S(),h("div"))}}),Q=w({__name:"alipay-qrcode",props:{payPrice:{type:Number,required:!0}},emits:["close"],setup(a,{emit:l}){const n=a,c=l,i=q(),r=d(""),t=d(""),u=d(!1);async function _(){const{data:e}=await B({type:f.alipay,payPrice:n.payPrice});t.value=e}async function p(){await i.value.createSse(t.value)}async function s(){u.value=!0,await _(),await p();const{data:e}=await O({type:f.alipay,payPrice:n.payPrice,tradeNo:t.value});r.value=e,u.value=!1}function P(e){e!=null&&e.charge&&(e==null?void 0:e.payPrice)===n.payPrice&&c("close",!0)}async function k(){const{data:e}=await $(t.value);["paid","finished"].includes(e)&&c("close",!0)}return E(()=>{s()}),(e,G)=>{const g=A,x=C,b=D,M=I;return S(),h(R,null,[o(F,{ref_key:"sseRef",ref:i,onReceiveMsg:P},null,512),o(M,{open:!0,"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"支付宝扫码支付",onOk:k},{default:m(()=>[o(g,{type:"warning",message:"支付成功后页面长时间无响应请点击已支付按钮"}),o(b,{spinning:v(u),tip:"付款码正在加载中"},{default:m(()=>[o(x,{size:270,value:v(r)},null,8,["value"])]),_:1},8,["spinning"])]),_:1})],64)}}});export{f as P,Q as _};
