import{d as W,aq as X,f as _,c as z,s as Y,o as Z,a5 as v,ac as P,ad as t,k as a,u as e,G as c,ak as ee,ag as te,a3 as I,F as q,al as ae,af as m,a8 as o,m as oe,A as se,a6 as ne,a7 as le}from"./vue-CP9fVXMC.js";import{_ as ue}from"./coupon.vue_vue_type_script_setup_true_lang-JE1hGB4r.js";import{v as ie,h as ce}from"./shop-C2Lr4vDI.js";import{P as T}from"./alipay-qrcode.vue_vue_type_script_setup_true_lang-D02PzK7V.js";import{p as re}from"./paymentMap-NdnFb-F_.js";import{a as pe,u as de,_ as _e}from"./index-BlSSTGFT.js";import{a$ as me,b0 as ve,b1 as fe,b2 as ye,b3 as be,S as he,m as Ce,aR as xe,a9 as we,aa as ge,aH as ke,ab as Be,am as Se}from"./antd-Do4zFXs5.js";const u=f=>(ne("data-v-56b5873e"),f=f(),le(),f),Pe=u(()=>o("p",{class:"text-muted"}," * 如开启自动续费，请确保账号余额充足 ",-1)),Ie=u(()=>o("p",{class:"text-muted"}," * 默认抵扣账户余额 ",-1)),Te=u(()=>o("ul",null,[o("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),o("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),$e={class:"invoice-box"},Ae=u(()=>o("span",{class:"text-muted"},"商品名称",-1)),Me=u(()=>o("br",null,null,-1)),Ne={class:"invoice-value"},Re={class:"invoice-box"},De=u(()=>o("span",{class:"text-muted"},"总价",-1)),Fe=u(()=>o("br",null,null,-1)),Ve={class:"invoice-value"},ze={key:0},qe={class:"invoice-box"},Le=u(()=>o("span",{class:"text-muted"},"账户余额",-1)),Ee=u(()=>o("br",null,null,-1)),Ge={class:"invoice-value"},He={class:"invoice-box"},Ue=u(()=>o("span",{class:"text-muted"},"还需要支付",-1)),je=u(()=>o("br",null,null,-1)),Je={class:"invoice-value"},Ke=W({__name:"buy",props:{coverId:{type:Number,required:!0}},emits:["closeBuy"],setup(f,{emit:L}){const E=f,G=L,H=X(),$=_(""),p=_(),l=_(),A=_(!0),y=_(!1),C=_(T.alipay),M=_(),x=pe(),N=de();async function U(){const{data:r}=await ie(E.coverId);M.value=r,A.value=!1}const R=z(()=>{var s,d;if(!l.value)return null;const r=p.value?p.value:(s=l.value)==null?void 0:s.price;return x.userInfo.money>=r?r:(d=x.userInfo)==null?void 0:d.money}),w=z(()=>{var s;if(!R.value)return null;const r=p.value?p.value:(s=l.value)==null?void 0:s.price;return Math.max(0,r-R.value).toFixed(2)}),g=Y(),k=_(!1);async function j(){if(w.value<=0)return await D();g.value=re[C.value],k.value=!0}async function J(r){k.value=!1,g.value=void 0,r&&await D()}async function D(){if(!l.value){N.error("请选择套餐时长");return}await ce({coupon:$.value,shopId:l.value.id,autoRenew:y.value}),N.success("购买成功o(*￣▽￣*)ブ"),await H.push({path:"/bought/pay-success",replace:!0})}return Z(()=>{U()}),(r,s)=>{const d=he,B=Ce,K=xe,h=we,F=ge,O=ke,V=Be,Q=Se;return v(),P(Q,{width:"700px",title:"购买页",open:!0,onCancel:s[4]||(s[4]=n=>G("closeBuy"))},{footer:t(()=>{var n;return[a(ue,{"shop-id":(n=e(l))==null?void 0:n.id,onApplyCoupon:s[0]||(s[0]=i=>{$.value=i.couponCode,p.value=i.discountedPrice})},null,8,["shop-id"]),a(d,{key:"submit",type:"primary",onClick:j},{default:t(()=>[c(" 购买 ")]),_:1})]}),default:t(()=>[e(k)?(v(),P(ee(e(g)),{key:0,"pay-price":e(w),onClose:J},null,40,["pay-price"])):te("",!0),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(me),{"two-tone-color":"#eb2f96"}),c(" 选择时长 ")]),default:t(()=>[a(K,{spinning:e(A)},{default:t(()=>[a(B,{size:[40,16],wrap:""},{default:t(()=>{var n;return[(v(!0),I(q,null,ae((n=e(M))==null?void 0:n.shopList,i=>{var b;return v(),P(d,{key:i.id,type:((b=e(l))==null?void 0:b.id)===i.id?"primary":"default",class:"buyButton",onClick:S=>l.value=i},{default:t(()=>[c(m(i.content.expire)+"天 ",1)]),_:2},1032,["type","onClick"])}),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(ve),{"two-tone-color":"#52c41a"}),c(" 自动续费 ")]),default:t(()=>[a(B,{size:20},{default:t(()=>[a(d,{class:"buyButton",type:e(y)?"primary":"default",onClick:s[1]||(s[1]=n=>y.value=!0)},{default:t(()=>[c(" 开启 ")]),_:1},8,["type"]),a(d,{class:"buyButton",type:e(y)?"default":"primary",onClick:s[2]||(s[2]=n=>y.value=!1)},{default:t(()=>[c(" 关闭 ")]),_:1},8,["type"])]),_:1}),Pe]),_:1}),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(fe)),c(" 支付方式 ")]),default:t(()=>[a(B,{size:20},{default:t(()=>[a(d,{class:"payButton",type:e(C)===e(T).alipay?"primary":"default",onClick:s[3]||(s[3]=n=>C.value=e(T).alipay)},{icon:t(()=>[a(e(ye))]),default:t(()=>[c(" 支付宝 ")]),_:1},8,["type"])]),_:1}),Ie]),_:1}),a(V,{gutter:24},{default:t(()=>[a(F,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:16},xl:{span:16}},{default:t(()=>[a(h,{bordered:!1},{title:t(()=>[a(e(be)),c(" 购买须知 ")]),default:t(()=>[Te]),_:1})]),_:1}),a(F,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:8},xl:{span:8}},{default:t(()=>[a(O,{vertical:""},{default:t(()=>{var n,i,b,S;return[o("div",$e,[Ae,Me,o("span",Ne,m((n=e(l))==null?void 0:n.name),1)]),o("div",Re,[De,Fe,oe(o("span",{class:"invoice-value discounted-invoice-value"}," ￥ "+m(e(p)),513),[[se,e(p)]]),o("span",Ve,[e(p)?(v(),I("del",ze," ￥ "+m((i=e(l))==null?void 0:i.price),1)):(v(),I(q,{key:1},[c(" ￥ "+m((b=e(l))==null?void 0:b.price),1)],64))])]),o("div",qe,[Le,Ee,o("span",Ge,"￥ "+m((S=e(x).userInfo)==null?void 0:S.money),1)]),o("div",He,[Ue,je,o("span",Je,"￥ "+m(e(w)),1)])]}),_:1})]),_:1})]),_:1}),a(V,{style:{marginBottom:"50px"}})]),_:1})}}}),tt=_e(Ke,[["__scopeId","data-v-56b5873e"]]);export{tt as default};
