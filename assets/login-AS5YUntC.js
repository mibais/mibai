var ae=Object.defineProperty;var ie=(n,o,a)=>o in n?ae(n,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[o]=a;var f=(n,o,a)=>(ie(n,typeof o!="symbol"?o+"":o,a),a);import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-FS6iUtA-.js";import{_ as re,a as le,b as pe}from"./login-left-Bw9zNeE0.js";import{_ as ue}from"./logo-CmUnSVuR.js";import{j as q,f as de,k as z,g as me,m as A,A as _e,_ as he,n as ge}from"./index-BfKtmSYb.js";import{g as w}from"./tools-Dodqzc0R.js";import{d as k,W as fe,r as ve,s as M,f as K,ap as we,o as I,u as e,j as be,a3 as P,a8 as i,af as v,ac as $,k as c,ad as m,aq as E,a5 as h,ag as ye,G as B,a6 as xe,a7 as ke,ak as Ce}from"./vue-CP9fVXMC.js";import{I as Le,W as Me,U as $e,X as qe,Y as ze,Z as Ae,$ as Ie,Q as Pe,T as Ee,J as Se,a0 as Te,a1 as We,a2 as Be,a3 as Re,K as Ue}from"./antd-BiDZImxE.js";var Oe=async(n=0)=>new Promise(o=>{const a=setTimeout(()=>{o(!0),clearTimeout(a)},n)});const t={width:0,height:0,canvas:null,ctx:null,circles:[],animate:!0,requestId:null},Ge=function(n){if(!t||!n)throw new Error("no canvasInstance");t.width=window.innerWidth,t.height=window.innerHeight,t.canvas=n,t.canvas.width=t.width,t.canvas.height=t.height,t.ctx=t.canvas.getContext("2d"),t.circles=[];for(let o=0;o<t.width*.5;o++){const a=new Ne;t.circles.push(a)}H(),je()};function V(){t.animate=!(document.body.scrollTop>t.height)}function F(){t.width=window.innerWidth,t.height=window.innerHeight,t.canvas.width=t.width,t.canvas.height=t.height}function H(){if(t.animate){t.ctx.clearRect(0,0,t.width,t.height);for(const n in t.circles)t.circles[n].draw()}t.requestId=requestAnimationFrame(H)}class Ne{constructor(){f(this,"pos");f(this,"alpha");f(this,"scale");f(this,"velocity");f(this,"draw");this.pos={x:Math.random()*t.width,y:t.height+Math.random()*100},this.alpha=.1+Math.random()*.3,this.scale=.1+Math.random()*.3,this.velocity=Math.random();const o=Math.random()*255,a=Math.random()*255,u=Math.random()*255;this.draw=function(){this.pos.y-=this.velocity,this.alpha-=5e-4,t.ctx.beginPath(),t.ctx.arc(this.pos.x,this.pos.y,this.scale*10,0,2*Math.PI,!1),t.ctx.fillStyle=`rgba(${o},${a},${u},${this.alpha})`,t.ctx.fill()}}}function je(){window.addEventListener("scroll",V),window.addEventListener("resize",F)}function Ke(){window.removeEventListener("scroll",V),window.removeEventListener("resize",F),cancelAnimationFrame(t.requestId)}const N={init:Ge,removeListeners:Ke},R=n=>(xe("data-v-133ec6e4"),n=n(),ke(),n),Ve={class:"login-container"},Fe={"h-screen":"","w-screen":"",absolute:"","z-10":""},He={class:"login-content flex-center"},De={class:"ant-pro-form-login-main rounded"},Qe={class:"flex-between h-15 px-4 mb-[2px]"},Je={class:"flex-end"},Xe=R(()=>i("span",{class:"ant-pro-form-login-logo"},[i("img",{"w-full":"","h-full":"","object-cover":"",src:ue})],-1)),Ye=R(()=>i("span",{class:"ant-pro-form-login-title"}," 米白云 ",-1)),Ze={class:"ant-pro-form-login-desc"},et={class:"login-lang flex-center relative z-11"},tt={class:"box-border flex min-h-[520px]"},ot=R(()=>i("div",{class:"ant-pro-form-login-main-left min-h-[520px] flex-center bg-[var(--bg-color-container)]"},[i("img",{src:re,class:"h-5/6 w-5/6"})],-1)),st={class:"ant-pro-form-login-main-right px-5 w-[335px] flex-center flex-col relative z-11"},nt={class:"text-center py-6 text-2xl"},at={class:"mb-24px flex-between"},it={href:"/forget"},ct={class:"text-slate-500"},rt={class:"ant-pro-form-login-other"},lt=60,pt=k({__name:"login-sys",setup(n){const o=q(),a=de(),{layoutSetting:u}=fe(a),d=E(),l=z(),s=ve({email:void 0,password:void 0,mobile:void 0,code:void 0,type:"account",remember:!0}),{t:r}=me(),b=M(),y=M(!1),C=M(!1),L=K(),{pause:D}=we(1e3,{controls:!0,immediate:!1,callback(g){g&&g===lt&&D()}});function Q(){window.location.href="https://github.com/login/oauth/authorize?client_id=de35e0cc0e281d788019"}function J(){window.location.href="https://openauth.alipay.com/oauth2/publicAppAuthorize.htm?app_id=2019111369130198&scope=auth_user&redirect_uri=https://6678.mibai.live/login?type=alipay"}function X(){window.location.href="https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/userinfo.email&include_granted_scopes=true&response_type=token&redirect_uri=https://alipay.mibai.live/login&state=google&client_id=1085614457190-vd0bt5slhitqelu6qhpb6444luc3rmi4.apps.googleusercontent.com"}async function S(){var g;y.value=!0;try{await((g=b.value)==null?void 0:g.validate());const p={email:s.email,password:s.password,type:"sys"},{data:x}=await A(p);l.value=x==null?void 0:x.token,o.success({message:"登录成功",description:"欢迎回来！",duration:3});const T=w("redirect","/");await d.push({path:T,replace:!0})}catch(p){p instanceof _e&&(C.value=!0),y.value=!1}}return I(async()=>{await Oe(300),N.init(e(L))}),be(()=>{N.removeListeners()}),(g,p)=>{const x=le,T=pe,Y=ce,W=Le,U=Pe,Z=Ee,ee=Se,te=Te,O=We,oe=Be,se=Re,G=Ue,ne=Me;return h(),P("div",Ve,[i("div",Fe,[i("canvas",{ref_key:"bubbleCanvas",ref:L},null,512)]),i("div",He,[i("div",De,[i("div",Qe,[i("div",Je,[Xe,Ye,i("span",Ze,v(e(r)("pages.layouts.userLayout.title")),1)]),i("div",et,[i("span",{class:"flex-center cursor-pointer text-16px",onClick:p[0]||(p[0]=_=>e(a).toggleTheme(e(u).theme==="dark"?"light":"dark"))},[e(u).theme==="light"?(h(),$(x,{key:0})):(h(),$(T,{key:1}))]),c(Y)])]),c(W,{"m-0":""}),i("div",tt,[ot,c(W,{"m-0":"",type:"vertical",class:"ant-pro-login-divider min-h-[520px]"}),i("div",st,[i("div",nt,v(e(r)("pages.login.tips")),1),c(ne,{ref_key:"formRef",ref:b,model:e(s)},{default:m(()=>[c(Z,{activeKey:e(s).type,"onUpdate:activeKey":p[1]||(p[1]=_=>e(s).type=_),centered:""},{default:m(()=>[c(U,{key:"account",tab:e(r)("pages.login.accountLogin.tab")},null,8,["tab"]),c(U,{key:"mobile",disabled:"",tab:e(r)("pages.login.phoneLogin.tab")},null,8,["tab"])]),_:1},8,["activeKey"]),e(C)?(h(),$(ee,{key:0,"mb-24px":"",message:e(r)("pages.login.accountLogin.errorMessage"),type:"error","show-icon":""},null,8,["message"])):ye("",!0),c(O,{name:"email",rules:[{required:!0,message:e(r)("pages.login.email.required")}]},{default:m(()=>[c(te,{value:e(s).email,"onUpdate:value":p[2]||(p[2]=_=>e(s).email=_),"allow-clear":"",autocomplete:"off",placeholder:e(r)("pages.login.email.placeholder"),size:"large",onPressEnter:S},{prefix:m(()=>[c(e($e))]),_:1},8,["value","placeholder"])]),_:1},8,["rules"]),c(O,{name:"password",rules:[{required:!0,message:e(r)("pages.login.password.required")}]},{default:m(()=>[c(oe,{value:e(s).password,"onUpdate:value":p[3]||(p[3]=_=>e(s).password=_),"allow-clear":"",placeholder:e(r)("pages.login.password.placeholder"),size:"large",onPressEnter:S},{prefix:m(()=>[c(e(qe))]),_:1},8,["value","placeholder"])]),_:1},8,["rules"]),i("div",at,[c(se,{checked:e(s).remember,"onUpdate:checked":p[4]||(p[4]=_=>e(s).remember=_)},{default:m(()=>[B(v(e(r)("pages.login.rememberMe")),1)]),_:1},8,["checked"]),i("a",it,v(e(r)("pages.login.forgotPassword")),1)]),c(G,{type:"primary",block:"",loading:e(y),size:"large",onClick:S},{default:m(()=>[B(v(e(r)("pages.login.submit")),1)]),_:1},8,["loading"]),c(G,{"mt-5":"",block:"",href:"/register"},{default:m(()=>[B(" 没有账号？去注册 ")]),_:1})]),_:1},8,["model"]),c(W,null,{default:m(()=>[i("span",ct,v(e(r)("pages.login.loginWith")),1)]),_:1}),i("div",rt,[c(e(ze),{class:"icon",onClick:Q}),c(e(Ae),{disabled:"",class:"icon",onClick:J}),c(e(Ie),{disabled:"",class:"icon",onClick:X})])])])])])])}}}),j=he(pt,[["__scopeId","data-v-133ec6e4"]]),ut=k({__name:"login-github",setup(n){const o=z(),a=E(),u=q();async function d(){const{data:l}=await A({type:"github",code:w("code")});o.value=l==null?void 0:l.token,u.success({message:"登录成功",description:"欢迎回来！",duration:3});const s=w("redirect","/");a.push({path:s,replace:!0})}return I(()=>{d()}),(l,s)=>(h(),P("div"))}}),dt=k({__name:"login-alipay",setup(n){const o=z(),a=E(),u=q();async function d(){const{data:l}=await A({type:"alipay",code:w("auth_code")});o.value=l==null?void 0:l.token,u.success({message:"登录成功",description:"欢迎回来！",duration:3});const s=w("redirect","/");a.push({path:s,replace:!0})}return I(()=>{d()}),(l,s)=>(h(),P("div"))}}),mt=k({__name:"login-google",props:{hashParams:{type:Object,required:!0}},setup(n){const o=n,a=z(),u=E(),d=q();async function l(){const{data:s}=await A({type:"google",code:o.hashParams.access_token});a.value=s==null?void 0:s.token,d.success({message:"登录成功",description:"欢迎回来！",duration:3}),u.push({path:"/",replace:!0})}return I(()=>{l()}),(s,r)=>(h(),P("div"))}}),xt=k({__name:"login",setup(n){const o=M(),a={sys:j,github:ut,alipay:dt,google:mt},u=K(l());let d=w("code");d||(d=u.value.state??""),o.value=a[d]??j;function l(){const r=ge.currentRoute.value.hash.substring(1).split("&"),b={};return r.forEach(y=>{const[C,L]=y.split("=");b[C]=L}),b}return(s,r)=>(h(),$(Ce(e(o)),{"hash-params":e(u)},null,8,["hash-params"]))}});export{xt as default};
