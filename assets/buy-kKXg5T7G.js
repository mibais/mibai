import{d as W,ap as X,f as _,c as z,s as Y,o as Z,a5 as v,ac as I,ad as t,k as a,u as e,G as i,ak as ee,ag as te,a3 as P,F as L,al as ae,af as m,a8 as s,m as se,A as oe,a6 as ne,a7 as le}from"./vue-DZ3ObLO4.js";import{_ as ue}from"./coupon.vue_vue_type_script_setup_true_lang-DqPWcDi9.js";import{v as ce,h as ie}from"./shop-DK2aaRFI.js";import{P as T,p as re}from"./alipay-qrcode.vue_vue_type_script_setup_true_lang-C5U6M4DQ.js";import{a as pe,u as de,_ as _e}from"./index-DcB7UUez.js";import{b1 as me,b2 as ve,b3 as fe,b4 as ye,b5 as be,I as he,l as Ce,aT as xe,ag as we,ah as ge,aM as ke,ai as Be,as as Se}from"./antd-CHYaqX98.js";const u=f=>(ne("data-v-c42dc323"),f=f(),le(),f),Ie=u(()=>s("p",{class:"text-muted"}," * 如开启自动续费，请确保账号余额充足 ",-1)),Pe=u(()=>s("p",{class:"text-muted"}," * 默认抵扣账户余额 ",-1)),Te=u(()=>s("ul",null,[s("li",null,"购买会员计划即代表同意《服务条款》和《使用政策》"),s("li",null,"如果购买套餐后遇到使用问题，请点击网页右下角联系在线客服")],-1)),Me={class:"invoice-box"},$e=u(()=>s("span",{class:"text-muted"},"商品名称",-1)),Ae=u(()=>s("br",null,null,-1)),Ne={class:"invoice-value"},De={class:"invoice-box"},Fe=u(()=>s("span",{class:"text-muted"},"总价",-1)),Re=u(()=>s("br",null,null,-1)),Ve={class:"invoice-value"},ze={key:0},Le={class:"invoice-box"},qe=u(()=>s("span",{class:"text-muted"},"账户余额",-1)),Ee=u(()=>s("br",null,null,-1)),Ge={class:"invoice-value"},Ue={class:"invoice-box"},je=u(()=>s("span",{class:"text-muted"},"还需要支付",-1)),He=u(()=>s("br",null,null,-1)),Je={class:"invoice-value"},Ke=W({__name:"buy",props:{coverId:{type:Number,required:!0}},emits:["closeBuy"],setup(f,{emit:q}){const E=f,G=q,U=X(),M=_(""),p=_(),l=_(),$=_(!0),y=_(!1),C=_(T.alipay),A=_(),x=pe(),N=de();async function j(){const{data:r}=await ce(E.coverId);A.value=r,$.value=!1}const D=z(()=>{var o,d;if(!l.value)return null;const r=p.value?p.value:(o=l.value)==null?void 0:o.price;return x.userInfo.money>=r?r:(d=x.userInfo)==null?void 0:d.money}),w=z(()=>{var o;if(!D.value)return null;const r=p.value?p.value:(o=l.value)==null?void 0:o.price;return Math.max(0,r-D.value).toFixed(2)}),g=Y(),k=_(!1);async function H(){if(w.value<=0)return await F();g.value=re[C.value],k.value=!0}async function J(r){k.value=!1,g.value=void 0,r&&await F()}async function F(){if(!l.value){N.error("请选择套餐时长");return}await ie({coupon:M.value,shopId:l.value.id,autoRenew:y.value}),N.success("购买成功o(*￣▽￣*)ブ"),await U.push({path:"/bought/pay-success",replace:!0})}return Z(()=>{j()}),(r,o)=>{const d=he,B=Ce,K=xe,h=we,R=ge,O=ke,V=Be,Q=Se;return v(),I(Q,{width:"700px",title:"购买页",open:!0,onCancel:o[4]||(o[4]=n=>G("closeBuy"))},{footer:t(()=>{var n;return[a(ue,{"shop-id":(n=e(l))==null?void 0:n.id,onApplyCoupon:o[0]||(o[0]=c=>{M.value=c.couponCode,p.value=c.discountedPrice})},null,8,["shop-id"]),a(d,{key:"submit",type:"primary",onClick:H},{default:t(()=>[i(" 购买 ")]),_:1})]}),default:t(()=>[e(k)?(v(),I(ee(e(g)),{key:0,"pay-price":e(w),onClose:J},null,40,["pay-price"])):te("",!0),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(me),{"two-tone-color":"#eb2f96"}),i(" 选择时长 ")]),default:t(()=>[a(K,{spinning:e($)},{default:t(()=>[a(B,{size:[40,16],wrap:""},{default:t(()=>{var n;return[(v(!0),P(L,null,ae((n=e(A))==null?void 0:n.shopList,c=>{var b;return v(),I(d,{key:c.id,type:((b=e(l))==null?void 0:b.id)===c.id?"primary":"default",class:"buyButton",onClick:S=>l.value=c},{default:t(()=>[i(m(c.content.expire)+"天 ",1)]),_:2},1032,["type","onClick"])}),128))]}),_:1})]),_:1},8,["spinning"])]),_:1}),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(ve),{"two-tone-color":"#52c41a"}),i(" 自动续费 ")]),default:t(()=>[a(B,{size:20},{default:t(()=>[a(d,{class:"buyButton",type:e(y)?"primary":"default",onClick:o[1]||(o[1]=n=>y.value=!0)},{default:t(()=>[i(" 开启 ")]),_:1},8,["type"]),a(d,{class:"buyButton",type:e(y)?"default":"primary",onClick:o[2]||(o[2]=n=>y.value=!1)},{default:t(()=>[i(" 关闭 ")]),_:1},8,["type"])]),_:1}),Ie]),_:1}),a(h,{bordered:!1,style:{background:"transparent"}},{title:t(()=>[a(e(fe)),i(" 支付方式 ")]),default:t(()=>[a(B,{size:20},{default:t(()=>[a(d,{class:"payButton",type:e(C)===e(T).alipay?"primary":"default",onClick:o[3]||(o[3]=n=>C.value=e(T).alipay)},{icon:t(()=>[a(e(ye))]),default:t(()=>[i(" 支付宝 ")]),_:1},8,["type"])]),_:1}),Pe]),_:1}),a(V,{gutter:24},{default:t(()=>[a(R,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:16},xl:{span:16}},{default:t(()=>[a(h,{bordered:!1},{title:t(()=>[a(e(be)),i(" 购买须知 ")]),default:t(()=>[Te]),_:1})]),_:1}),a(R,{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:8},xl:{span:8}},{default:t(()=>[a(O,{vertical:""},{default:t(()=>{var n,c,b,S;return[s("div",Me,[$e,Ae,s("span",Ne,m((n=e(l))==null?void 0:n.name),1)]),s("div",De,[Fe,Re,se(s("span",{class:"invoice-value discounted-invoice-value"}," ￥ "+m(e(p)),513),[[oe,e(p)]]),s("span",Ve,[e(p)?(v(),P("del",ze," ￥ "+m((c=e(l))==null?void 0:c.price),1)):(v(),P(L,{key:1},[i(" ￥ "+m((b=e(l))==null?void 0:b.price),1)],64))])]),s("div",Le,[qe,Ee,s("span",Ge,"￥ "+m((S=e(x).userInfo)==null?void 0:S.money),1)]),s("div",Ue,[je,He,s("span",Je,"￥ "+m(e(w)),1)])]}),_:1})]),_:1})]),_:1}),a(V,{style:{marginBottom:"50px"}})]),_:1})}}}),et=_e(Ke,[["__scopeId","data-v-c42dc323"]]);export{et as default};
