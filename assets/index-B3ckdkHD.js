import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-B0nG_uX1.js";import{F as me,d as fe,aS as ge,$ as ve,a0 as xe,ai as ke,aB as he,aj as ye,aO as Ce,S as be,x as we,J as Ie,m as Se,V as Ue,ah as $e,a2 as ze,aT as Le,D as Ae,w as Ne,aa as Be,aC as De,au as Ee,s as Ve}from"./antd-_WrWzocG.js";import{U as v}from"./enum-KIDSNew-.js";import{u as Oe,_ as Re,d as je}from"./edit.vue_vue_type_script_setup_true_lang-C49KNSJc.js";import{u as Fe}from"./index-H6zaxqu3.js";import{d as Me,f as p,s as Te,c as D,r as F,w as M,o as Ye,a5 as i,ac as c,ad as e,k as t,u as n,H as T,a3 as E,F as V,al as He,G as u,af as x,ag as _,ak as Je,a8 as Qe}from"./vue-f4UZefmh.js";import"./context-zShw-svS.js";const Ge=Qe("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),at=Me({__name:"index",setup(Pe){const I=p(!1),z=p(!1),L=Te([{title:"#",dataIndex:"id"},{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"分组",dataIndex:"group"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",width:200}]),m=D(()=>L.value.map(a=>a.dataIndex)),A=p(),r=F({indeterminate:!1,checkAll:!0,checkList:m.value}),Y=D(()=>L.value.map(a=>a.dataIndex==="action"?{label:a.title,value:a.dataIndex,disabled:!0}:{label:a.title,value:a.dataIndex})),H=D(()=>{const a={};for(const l in v)a[l]=v[l];return a}),O=p(),f=F({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,l){f.pageSize=l,f.current=a,C()}}),s=p({}),k=p(!1);async function C(){if(!I.value){I.value=!0;try{const{data:a}=await Oe({size:f.pageSize,current:f.current,param:s.value});O.value=a.records,f.total=a.total,f.pageSize=a.size,f.current=a.current}finally{I.value=!1}}}function S(a){return L.value.filter(l=>a.includes(l.dataIndex))}const b=p(S(m.value));function J(a){Object.assign(r,{checkList:a.target.checked?m.value:[],indeterminate:!0}),b.value=a.target.checked?S(m.value):b.value.filter(l=>l.dataIndex==="action")}M(()=>r.checkList,a=>{r.indeterminate=!!a.length&&a.length<m.value.length,r.checkAll=a.length===m.value.length});function Q(){r.checkList=m.value,b.value=S(m.value)}const G=p();function P(){C()}function q(a){const l=S(a);b.value=l}function K(a){A.value=a.id,k.value=!0}async function W(a){await je(a),Fe().success("用户删除成功"),await C()}function X(){A.value=void 0,k.value=!0}function Z(a){k.value=!1,a&&C()}const U=p();return M(U,a=>{s.value.startClassExpire=a?a[0]:void 0,s.value.endClassExpire=a?a[1]:void 0}),Ye(()=>{C()}),(a,l)=>{const R=ve,h=xe,g=ke,j=he,$=ye,ee=Ce,te=be,ae=we,w=Ie,N=Se,ne=Ue,B=$e,le=ze,oe=Le,se=Ae,ue=Ne,y=Be,ie=De,de=Ee,re=Ve,ce=pe;return i(),c(ce,null,{title:e(()=>[Ge]),default:e(()=>[t(B,{"mb-4":""},{default:e(()=>[t(ne,{modal:n(s)},{default:e(()=>[t($,{gutter:16},{default:e(()=>[t(g,{span:8},{default:e(()=>[t(h,{label:"用户名",name:"userName"},{default:e(()=>[t(R,{value:n(s).userName,"onUpdate:value":l[0]||(l[0]=o=>n(s).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(h,{label:"邮箱",name:"email"},{default:e(()=>[t(R,{value:n(s).email,"onUpdate:value":l[1]||(l[1]=o=>n(s).email=o)},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(h,{label:"用户等级",name:"grade"},{default:e(()=>[t(j,{value:n(s).grade,"onUpdate:value":l[2]||(l[2]=o=>n(s).grade=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t($,{gutter:16},{default:e(()=>[t(g,{span:8},{default:e(()=>[t(h,{label:"等级到期"},{default:e(()=>[t(ee,{value:n(U),"onUpdate:value":l[3]||(l[3]=o=>T(U)?U.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(h,{label:"状态",name:"status"},{default:e(()=>[t(ae,{value:n(s).status,"onUpdate:value":l[4]||(l[4]=o=>n(s).status=o),"allow-clear":!0},{default:e(()=>[(i(!0),E(V,null,He(n(H),(o,d)=>(i(),c(te,{key:d,value:d},{default:e(()=>[u(x(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(h,{label:"分组",name:"group"},{default:e(()=>[t(j,{value:n(s).group,"onUpdate:value":l[5]||(l[5]=o=>n(s).group=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t($,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(g,{span:24},{default:e(()=>[t(N,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(w,{loading:n(G),type:"primary",onClick:P},{default:e(()=>[u(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t($,{gutter:24},{default:e(()=>[t(g,{span:24},{default:e(()=>[t(B,{title:"用户列表"},{extra:e(()=>[t(N,{size:24},{default:e(()=>[t(w,{type:"default",onClick:X},{default:e(()=>[u(" 添加用户 ")]),_:1}),t(ue,{title:"列设置"},{default:e(()=>[t(se,{open:n(z),"onUpdate:open":l[8]||(l[8]=o=>T(z)?z.value=o:null),trigger:"click"},{overlay:e(()=>[t(B,null,{title:e(()=>[t(le,{checked:n(r).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>n(r).checkAll=o),indeterminate:n(r).indeterminate,onChange:J},{default:e(()=>[u(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[t(w,{type:"link",onClick:Q},{default:e(()=>[u(" 重置 ")]),_:1})]),default:e(()=>[t(oe,{value:n(r).checkList,"onUpdate:value":l[7]||(l[7]=o=>n(r).checkList=o),options:n(Y),style:{display:"flex","flex-direction":"column"},onChange:q},null,8,["value","options"])]),_:1})]),default:e(()=>[t(n(me))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[t(de,{loading:n(I),columns:n(b),"data-source":n(O),pagination:n(f),scroll:{x:100}},{bodyCell:e(({column:o,record:d})=>[o.dataIndex==="status"?(i(),E(V,{key:0},[d.status==="forbidden"?(i(),c(y,{key:0,color:"purple"},{default:e(()=>[u(x(n(v).forbidden),1)]),_:1})):_("",!0),d.status==="excess"?(i(),c(y,{key:1,color:"orange"},{default:e(()=>[u(x(n(v).excess),1)]),_:1})):_("",!0),d.status==="normal"?(i(),c(y,{key:2,color:"cyan"},{default:e(()=>[u(x(n(v).normal),1)]),_:1})):_("",!0),d.status==="paid"?(i(),c(y,{key:3,color:"green"},{default:e(()=>[u(x(n(v).paid),1)]),_:1})):_("",!0),d.status==="expire"?(i(),c(y,{key:4,color:"blue"},{default:e(()=>[u(x(n(v).expire),1)]),_:1})):_("",!0),d.status==="delete"?(i(),c(y,{key:5,color:"red"},{default:e(()=>[u(x(n(v).delete),1)]),_:1})):_("",!0)],64)):_("",!0),o.dataIndex==="classExpire"?(i(),E(V,{key:1},[u(x(n(fe)(d.classExpire).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="action"?(i(),c(N,{key:2},{default:e(()=>[t(w,{type:"default",onClick:_e=>K(d)},{default:e(()=>[u(" 修改 ")]),_:2},1032,["onClick"]),t(ie,{title:"确定要删除用户吗？",onConfirm:_e=>W(d.id)},{icon:e(()=>[t(n(ge))]),default:e(()=>[t(w,{danger:"",type:"primary"},{default:e(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(re,{title:"编辑用户",width:720,visible:n(k),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>k.value=!1)},{default:e(()=>[n(k)?(i(),c(Je(Re),{key:0,"user-id":n(A),onHandleClose:Z},null,40,["user-id"])):_("",!0)]),_:1},8,["visible"])]),_:1})}}});export{at as default};
