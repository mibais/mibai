import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-CWotRsuG.js";import{S as R,aw as H,b0 as J,d as B,b1 as P,b2 as L,a9 as W,aa as X,ab as Z,m as ee,an as te,am as ae}from"./antd-ClWK_BPx.js";import{B as p,d as ne,e as oe,r as se}from"./bought-Rp0vQxWP.js";import{_ as ie}from"./detail.vue_vue_type_script_setup_true_lang-B6dDiQQL.js";import{_ as ue}from"./refund.vue_vue_type_script_setup_true_lang-Bwe8zzX9.js";import{u as le,a as de,_ as ce}from"./index-E9vVtGBC.js";import{d as A,ab as re,a5 as r,ac as h,ad as e,k as a,u as t,G as m,af as y,ag as _,f as g,r as _e,o as pe,H as N,a3 as z,F as D,ak as me,a6 as fe,a7 as ge,a8 as w}from"./vue-DIvP5FMT.js";import"./context-CzpeglP3.js";import"./shop-DaZxHBIe.js";const he=A({__name:"auto_renew",props:{bought:{type:Object,required:!0},buttonType:{type:String,default:"default"},closeMessage:{type:String,default:"关闭成功 👋"},openMessage:{type:String,default:"开启成功 🎉"}},emits:["on-change"],setup(u,{emit:d}){const b=d,s=u;async function S(){await ne({boughtId:s.bought.id,userId:s.bought.userid}),le().success(s.bought.renew?s.closeMessage:s.openMessage),b("on-change",!s.bought.renew)}return(v,I)=>{const l=re("QuestionCircleOutlined"),f=R,k=H;return r(),h(k,{title:`确定要${u.bought.renew?"关闭":"开启"}？`,onConfirm:S},{icon:e(()=>[a(l)]),default:e(()=>[[t(p).using,t(p).no_use].includes(t(p)[u.bought.status])?(r(),h(f,{key:0,type:u.buttonType},{default:e(()=>[m(y(`${u.bought.renew?"关闭":"开启"}自动续费`),1)]),_:1},8,["type"])):_("",!0)]),_:1},8,["title"])}}}),x=u=>(fe("data-v-456569d8"),u=u(),ge(),u),ye=x(()=>w("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录",-1)),we=x(()=>w("p",null,"购买记录自失效后保留7天。失效指退款、过期等无效状态。",-1)),be=x(()=>w("p",null,"多次购买套餐不会覆盖，套餐处于未使用状态。未使用的套餐将在前一个套餐到期后自动使用。",-1)),ve=x(()=>w("p",null,[m("退款的款项只回到账户"),w("a",{href:"code"},"钱包"),m("中，无法原路退款到付款方")],-1)),xe=A({__name:"index",setup(u){const d=g(!1),b=g(0),s=g(!1),S=[{title:"商品名",dataIndex:"shopName",width:120},{title:"价格",dataIndex:"price",width:40},{title:"购买时间",dataIndex:"datetime",width:40},{title:"状态",dataIndex:"status",width:40},{title:"续费时间",dataIndex:"renewTime",width:80},{title:"操作",dataIndex:"action",width:120}],v=g([]),I=g(),l=_e({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:n=>`${n}条记录`,onChange(n,i){l.pageSize=i,l.current=n,f()}});async function f(){if(!s.value){s.value=!0;try{const{data:n}=await oe({size:l.pageSize,current:l.current});v.value=n.records,l.total=n.total,l.pageSize=n.size,l.current=n.current}finally{s.value=!1}}}async function k(n){d.value=!0,b.value=n.snapshotId}const C=g(["1"]);async function K(){const{data:n}=await se();I.value=n}async function U(n){n&&(await f(),await de().getUserInfo())}return pe(()=>{f(),K()}),(n,i)=>{const M=P,V=L,O=W,T=X,Y=Z,Q=R,j=ee,F=te,q=ae,E=G;return r(),h(E,null,{title:e(()=>[ye]),default:e(()=>[a(Y,{gutter:24},{default:e(()=>[a(T,{span:24},{default:e(()=>[a(O,{title:"提示"},{default:e(()=>[a(V,{activeKey:t(C),"onUpdate:activeKey":i[0]||(i[0]=o=>N(C)?C.value=o:null),bordered:!1,ghost:""},{expandIcon:e(o=>[a(t(J),{rotate:o!=null&&o.isActive?90:0},null,8,["rotate"])]),default:e(()=>[a(M,{key:"1",header:"购买记录保留几天",class:"triangle"},{default:e(()=>[we]),_:1}),a(M,{key:"2",header:"关于多次购买",class:"triangle"},{default:e(()=>[be]),_:1}),a(M,{key:"3",header:"关于退款",class:"triangle"},{default:e(()=>[ve]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})]),_:1}),a(Y,{gutter:24,"mt-5":""},{default:e(()=>[a(T,{span:24},{default:e(()=>[a(O,{title:"购买明细"},{default:e(()=>[a(F,{loading:t(s),columns:S,"data-source":t(v),pagination:t(l)},{bodyCell:e(({column:o,record:c})=>[o.dataIndex==="shopName"?(r(),h(Q,{key:0,type:"link",onClick:$=>k(c)},{default:e(()=>[m(y(c.shopName),1)]),_:2},1032,["onClick"])):_("",!0),o.dataIndex==="status"?(r(),z(D,{key:1},[m(y(t(p)[c.status]),1)],64)):_("",!0),o.dataIndex==="datetime"?(r(),z(D,{key:2},[m(y(t(B)(c.datetime).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="renewTime"?(r(),z(D,{key:3},[m(y(c.renewTime?t(B)(c.renewTime).format("YYYY-MM-DD"):"不自动续费"),1)],64)):_("",!0),o.dataIndex==="action"?(r(),h(j,{key:4},{default:e(()=>{var $;return[a(he,{bought:c,onOnChange:f},null,8,["bought"]),a(ue,{danger:"",visible:(($=t(I))==null?void 0:$.allowRefund)&&[t(p).using,t(p).no_use].includes(t(p)[c.status]),bought:c,onOnClose:U},null,8,["visible","bought"])]}),_:2},1024)):_("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1})]),_:1})]),_:1}),a(q,{open:t(d),"onUpdate:open":i[1]||(i[1]=o=>N(d)?d.value=o:null),width:"800px",title:"详情",onCancel:i[2]||(i[2]=o=>d.value=!1),onOk:i[3]||(i[3]=o=>d.value=!1)},{default:e(()=>[t(d)?(r(),h(me(ie),{key:0,"snapshot-id":t(b)},null,8,["snapshot-id"])):_("",!0)]),_:1},8,["open"])]),_:1})}}}),Te=ce(xe,[["__scopeId","data-v-456569d8"]]);export{Te as default};
