import{d as $,m as M,an as O,am as Y}from"./antd-BeZGkD-C.js";import{b as D,B as l,_ as V}from"./refund.vue_vue_type_script_setup_true_lang-BrC0JzPC.js";import{_ as j}from"./auto_renew.vue_vue_type_script_setup_true_lang-BGi4tZ6q.js";import{d as F,f as d,r as T,o as q,a5 as i,ac as I,ad as m,k as p,u as t,a3 as g,F as _,G as f,af as x,ag as c}from"./vue-CP9fVXMC.js";const Q=F({__name:"bought",props:{user:{type:Object,required:!0}},emits:["close"],setup(h,{emit:y}){const k=y,v=h,r=d(!1),w=d([{title:"#",dataIndex:"id"},{title:"商品名",dataIndex:"shopName"},{title:"购买日期",dataIndex:"datetime"},{title:"自动续费",dataIndex:"renew"},{title:"价格",dataIndex:"price"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action"}]),b=d(),a=T({pageSize:5,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`${e}条记录`,onChange(e,n){a.pageSize=n,a.current=e,u()}}),C=d({userId:v.user.id});async function u(){if(!r.value){r.value=!0;try{const{data:e}=await D({size:a.pageSize,current:a.current,param:C.value});b.value=e.records,a.total=e.total,a.pageSize=e.size,a.current=e.current}finally{r.value=!1}}}return q(()=>{u()}),(e,n)=>{const S=M,z=O,B=Y;return i(),I(B,{title:`${h.user.userName}的购买记录`,open:!0,width:1e3,onCancel:n[1]||(n[1]=o=>k("close"))},{default:m(()=>[p(z,{loading:t(r),columns:t(w),"data-source":t(b),pagination:t(a),scroll:{x:100}},{bodyCell:m(({column:o,record:s})=>[o.dataIndex==="datetime"?(i(),g(_,{key:0},[f(x(t($)(s.datetime).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="renew"?(i(),g(_,{key:1},[f(x(s.renew?"开启":"关闭"),1)],64)):c("",!0),o.dataIndex==="status"?(i(),g(_,{key:2},[f(x(t(l)[s.status]),1)],64)):c("",!0),o.dataIndex==="action"?(i(),I(S,{key:3},{default:m(()=>[p(j,{bought:s,onOnChange:u},null,8,["bought"]),p(V,{danger:"",visible:[t(l).using,t(l).no_use].includes(t(l)[s.status]),bought:s,onOnClose:n[0]||(n[0]=N=>N&&u())},null,8,["visible","bought"])]),_:2},1024)):c("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1},8,["title"])}}});export{Q as _};
