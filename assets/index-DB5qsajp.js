import{_ as G}from"./index.vue_vue_type_script_setup_true_lang-DbQh5QAG.js";import{b5 as H,d as M,aP as J,b6 as q,b7 as L,a9 as W,aa as X,ab as Z,S as ee,aw as te,m as ae,an as ne,am as oe}from"./antd-BBX7OAHx.js";import{d as se,B as _,e as ie,r as le}from"./bought-B_aTuobE.js";import{_ as ue}from"./detail.vue_vue_type_script_setup_true_lang-CERGxSXe.js";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang-CzRArotG.js";import{u as _e,_ as ce}from"./index-skrWRMkq.js";import{d as pe,f as r,r as re,o as me,a5 as u,ac as m,ad as e,k as n,u as t,H as N,G as p,af as f,ag as c,a3 as I,F as b,ak as fe,a6 as ge,a7 as he,a8 as g}from"./vue-CP9fVXMC.js";import"./context-BB3-u6iT.js";import"./shop-nXjpJehg.js";const y=h=>(ge("data-v-cd53e98b"),h=h(),he(),h),we=y(()=>g("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"购买记录",-1)),ve=y(()=>g("p",null,"购买记录自失效后保留7天。失效指退款、过期等无效状态。",-1)),ye=y(()=>g("p",null,"多次购买套餐不会覆盖，套餐处于未使用状态。未使用的套餐将在前一个套餐到期后自动使用。",-1)),xe=y(()=>g("p",null,[p("退款的款项只回到账户"),g("a",{href:"code"},"钱包"),p("中，无法原路退款到付款方")],-1)),ke=pe({__name:"index",setup(h){const d=r(!1),S=r(0),w=r(!1),R=[{title:"商品名",dataIndex:"shopName",width:120},{title:"价格",dataIndex:"price",width:40},{title:"购买时间",dataIndex:"datetime",width:40},{title:"状态",dataIndex:"status",width:40},{title:"续费时间",dataIndex:"renewTime",width:80},{title:"操作",dataIndex:"action",width:120}],$=r([]),T=r(),l=re({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,i){l.pageSize=i,l.current=a,v()}});async function A(a){await ie(a),_e().success(a.isClose?"关闭成功 👋":"开启成功 🎉"),await v()}async function v(){if(!w.value){w.value=!0;try{const{data:a}=await se({size:l.pageSize,current:l.current});$.value=a.records,l.total=a.total,l.pageSize=a.size,l.current=a.current}finally{w.value=!1}}}async function O(a){d.value=!0,S.value=a.snapshotId}const x=r(["1"]);async function K(){const{data:a}=await le();T.value=a}function V(a){a&&v()}return me(()=>{v(),K()}),(a,i)=>{const k=q,F=L,z=W,D=X,Y=Z,B=ee,P=te,Q=ae,U=ne,j=oe,E=G;return u(),m(E,null,{title:e(()=>[we]),content:e(()=>[n(Y,{gutter:24},{default:e(()=>[n(D,{span:24},{default:e(()=>[n(z,{title:"提示"},{default:e(()=>[n(F,{activeKey:t(x),"onUpdate:activeKey":i[0]||(i[0]=o=>N(x)?x.value=o:null),bordered:!1,ghost:""},{expandIcon:e(o=>[n(t(H),{rotate:o!=null&&o.isActive?90:0},null,8,["rotate"])]),default:e(()=>[n(k,{key:"1",header:"购买记录保留几天",class:"triangle"},{default:e(()=>[ve]),_:1}),n(k,{key:"2",header:"关于多次购买",class:"triangle"},{default:e(()=>[ye]),_:1}),n(k,{key:"3",header:"关于退款",class:"triangle"},{default:e(()=>[xe]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})]),_:1}),n(Y,{gutter:24,"mt-5":""},{default:e(()=>[n(D,{span:24},{default:e(()=>[n(z,{title:"购买明细"},{default:e(()=>[n(U,{loading:t(w),columns:R,"data-source":t($),pagination:t(l)},{bodyCell:e(({column:o,record:s})=>[o.dataIndex==="shopName"?(u(),m(B,{key:0,type:"link",onClick:C=>O(s)},{default:e(()=>[p(f(s.shopName),1)]),_:2},1032,["onClick"])):c("",!0),o.dataIndex==="status"?(u(),I(b,{key:1},[p(f(t(_)[s.status]),1)],64)):c("",!0),o.dataIndex==="datetime"?(u(),I(b,{key:2},[p(f(t(M)(s.datetime).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="renewTime"?(u(),I(b,{key:3},[p(f(s.renewTime?t(M)(s.renewTime).format("YYYY-MM-DD"):"不自动续费"),1)],64)):c("",!0),o.dataIndex==="action"?(u(),m(Q,{key:4},{default:e(()=>{var C;return[n(P,{title:`确定要${s.renewTime?"关闭":"开启"}？`,onConfirm:Ce=>A({isClose:!!s.renewTime,boughtId:s.id})},{icon:e(()=>[n(t(J))]),default:e(()=>[[t(_).using,t(_).no_use].includes(t(_)[s.status])?(u(),m(B,{key:0,type:"default"},{default:e(()=>[p(f(`${s.renewTime?"关闭":"开启"}自动续费`),1)]),_:2},1024)):c("",!0)]),_:2},1032,["title","onConfirm"]),n(de,{danger:"",visible:((C=t(T))==null?void 0:C.allowRefund)&&[t(_).using,t(_).no_use].includes(t(_)[s.status]),"bought-id":s.id,onOnClose:V},null,8,["visible","bought-id"])]}),_:2},1024)):c("",!0)]),_:1},8,["loading","data-source","pagination"])]),_:1})]),_:1})]),_:1})]),default:e(()=>[n(j,{open:t(d),"onUpdate:open":i[1]||(i[1]=o=>N(d)?d.value=o:null),width:"800px",title:"详情",onCancel:i[2]||(i[2]=o=>d.value=!1),onOk:i[3]||(i[3]=o=>d.value=!1)},{default:e(()=>[t(d)?(u(),m(fe(ue),{key:0,"snapshot-id":t(S)},null,8,["snapshot-id"])):c("",!0)]),_:1},8,["open"])]),_:1})}}}),Me=ce(ke,[["__scopeId","data-v-cd53e98b"]]);export{Me as default};
