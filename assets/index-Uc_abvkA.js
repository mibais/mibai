import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-DD5g0tKa.js";import{aO as me,d as fe,aP as ge,K as ve,N as ke,aa as xe,av as ye,ab as he,aK as Ce,aI as be,aJ as we,S as Ie,m as Ue,F as Se,a9 as ze,Q as Le,aQ as Ne,D as $e,ag as Ae,a0 as De,aw as Ee,an as Be,s as Oe}from"./antd-Do4zFXs5.js";import{U as v}from"./enum-KIDSNew-.js";import{u as Ve,_ as Re,d as Fe}from"./edit.vue_vue_type_script_setup_true_lang-D71zAgrS.js";import{u as Me}from"./index-CRpV0laT.js";import{d as Qe,f as p,s as Ye,c as E,r as M,w as Q,o as je,a5 as i,ac as c,ad as e,k as t,u as n,H as Y,a3 as B,F as O,al as Te,G as u,af as k,ag as _,ak as He,a8 as Je}from"./vue-CP9fVXMC.js";import"./context-CwG8GSpE.js";const Ke=Je("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),at=Qe({__name:"index",setup(Pe){const I=p(!1),L=p(!1),N=Ye([{title:"#",dataIndex:"id"},{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"分组",dataIndex:"group"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",width:200}]),m=E(()=>N.value.map(a=>a.dataIndex)),$=p(),r=M({indeterminate:!1,checkAll:!0,checkList:m.value}),j=E(()=>N.value.map(a=>a.dataIndex==="action"?{label:a.title,value:a.dataIndex,disabled:!0}:{label:a.title,value:a.dataIndex})),T=E(()=>{const a={};for(const l in v)a[l]=v[l];return a}),V=p(),f=M({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`${a}条记录`,onChange(a,l){f.pageSize=l,f.current=a,C()}}),s=p({}),x=p(!1);async function C(){if(!I.value){I.value=!0;try{const{data:a}=await Ve({size:f.pageSize,current:f.current,param:s.value});V.value=a.records,f.total=a.total,f.pageSize=a.size,f.current=a.current}finally{I.value=!1}}}function U(a){return N.value.filter(l=>a.includes(l.dataIndex))}const b=p(U(m.value));function H(a){Object.assign(r,{checkList:a.target.checked?m.value:[],indeterminate:!0}),b.value=a.target.checked?U(m.value):b.value.filter(l=>l.dataIndex==="action")}Q(()=>r.checkList,a=>{r.indeterminate=!!a.length&&a.length<m.value.length,r.checkAll=a.length===m.value.length});function J(){r.checkList=m.value,b.value=U(m.value)}const K=p();function P(){C()}function G(a){const l=U(a);b.value=l}function q(a){$.value=a.id,x.value=!0}async function W(a){await Fe(a),Me().success("用户删除成功"),await C()}function X(){$.value=void 0,x.value=!0}function Z(a){x.value=!1,a&&C()}const S=p();return Q(S,a=>{s.value.startClassExpire=a?a[0]:void 0,s.value.endClassExpire=a?a[1]:void 0}),je(()=>{C()}),(a,l)=>{const R=ve,y=ke,g=xe,F=ye,z=he,ee=Ce,te=be,ae=we,w=Ie,A=Ue,ne=Se,D=ze,le=Le,oe=Ne,se=$e,ue=Ae,h=De,ie=Ee,de=Be,re=Oe,ce=pe;return i(),c(ce,null,{title:e(()=>[Ke]),default:e(()=>[t(D,{"mb-4":""},{default:e(()=>[t(ne,{modal:n(s)},{default:e(()=>[t(z,{gutter:16},{default:e(()=>[t(g,{span:8},{default:e(()=>[t(y,{label:"用户名",name:"userName"},{default:e(()=>[t(R,{value:n(s).userName,"onUpdate:value":l[0]||(l[0]=o=>n(s).userName=o)},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(y,{label:"邮箱",name:"email"},{default:e(()=>[t(R,{value:n(s).email,"onUpdate:value":l[1]||(l[1]=o=>n(s).email=o)},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(y,{label:"用户等级",name:"grade"},{default:e(()=>[t(F,{value:n(s).grade,"onUpdate:value":l[2]||(l[2]=o=>n(s).grade=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{gutter:16},{default:e(()=>[t(g,{span:8},{default:e(()=>[t(y,{label:"等级到期"},{default:e(()=>[t(ee,{value:n(S),"onUpdate:value":l[3]||(l[3]=o=>Y(S)?S.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(y,{label:"状态",name:"status"},{default:e(()=>[t(ae,{value:n(s).status,"onUpdate:value":l[4]||(l[4]=o=>n(s).status=o),"allow-clear":!0},{default:e(()=>[(i(!0),B(O,null,Te(n(T),(o,d)=>(i(),c(te,{key:d,value:d},{default:e(()=>[u(k(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),t(g,{span:8},{default:e(()=>[t(y,{label:"分组",name:"group"},{default:e(()=>[t(F,{value:n(s).group,"onUpdate:value":l[5]||(l[5]=o=>n(s).group=o),min:0},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{span:24,style:{"text-align":"right"}},{default:e(()=>[t(g,{span:24},{default:e(()=>[t(A,{flex:"","justify-end":"","w-full":""},{default:e(()=>[t(w,{loading:n(K),type:"primary",onClick:P},{default:e(()=>[u(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),t(z,{gutter:24},{default:e(()=>[t(g,{span:24},{default:e(()=>[t(D,{title:"用户列表"},{extra:e(()=>[t(A,{size:24},{default:e(()=>[t(w,{type:"default",onClick:X},{default:e(()=>[u(" 添加用户 ")]),_:1}),t(ue,{title:"列设置"},{default:e(()=>[t(se,{open:n(L),"onUpdate:open":l[8]||(l[8]=o=>Y(L)?L.value=o:null),trigger:"click"},{overlay:e(()=>[t(D,null,{title:e(()=>[t(le,{checked:n(r).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>n(r).checkAll=o),indeterminate:n(r).indeterminate,onChange:H},{default:e(()=>[u(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[t(w,{type:"link",onClick:J},{default:e(()=>[u(" 重置 ")]),_:1})]),default:e(()=>[t(oe,{value:n(r).checkList,"onUpdate:value":l[7]||(l[7]=o=>n(r).checkList=o),options:n(j),style:{display:"flex","flex-direction":"column"},onChange:G},null,8,["value","options"])]),_:1})]),default:e(()=>[t(n(me))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[t(de,{loading:n(I),columns:n(b),"data-source":n(V),pagination:n(f),scroll:{x:100}},{bodyCell:e(({column:o,record:d})=>[o.dataIndex==="status"?(i(),B(O,{key:0},[d.status==="forbidden"?(i(),c(h,{key:0,color:"purple"},{default:e(()=>[u(k(n(v).forbidden),1)]),_:1})):_("",!0),d.status==="excess"?(i(),c(h,{key:1,color:"orange"},{default:e(()=>[u(k(n(v).excess),1)]),_:1})):_("",!0),d.status==="normal"?(i(),c(h,{key:2,color:"cyan"},{default:e(()=>[u(k(n(v).normal),1)]),_:1})):_("",!0),d.status==="paid"?(i(),c(h,{key:3,color:"green"},{default:e(()=>[u(k(n(v).paid),1)]),_:1})):_("",!0),d.status==="expire"?(i(),c(h,{key:4,color:"blue"},{default:e(()=>[u(k(n(v).expire),1)]),_:1})):_("",!0),d.status==="delete"?(i(),c(h,{key:5,color:"red"},{default:e(()=>[u(k(n(v).delete),1)]),_:1})):_("",!0)],64)):_("",!0),o.dataIndex==="classExpire"?(i(),B(O,{key:1},[u(k(n(fe)(d.classExpire).format("YYYY-MM-DD")),1)],64)):_("",!0),o.dataIndex==="action"?(i(),c(A,{key:2},{default:e(()=>[t(w,{type:"default",onClick:_e=>q(d)},{default:e(()=>[u(" 修改 ")]),_:2},1032,["onClick"]),t(ie,{title:"确定要删除用户吗？",onConfirm:_e=>W(d.id)},{icon:e(()=>[t(n(ge))]),default:e(()=>[t(w,{danger:"",type:"primary"},{default:e(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),t(re,{title:"编辑用户",width:720,visible:n(x),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>x.value=!1)},{default:e(()=>[n(x)?(i(),c(He(Re),{key:0,"user-id":n($),onHandleClose:Z},null,40,["user-id"])):_("",!0)]),_:1},8,["visible"])]),_:1})}}});export{at as default};
