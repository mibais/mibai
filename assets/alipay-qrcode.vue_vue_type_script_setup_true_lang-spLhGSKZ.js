import{q as y,a as q,v as R}from"./index-Hr0swFKW.js";import{d as S,a5 as w,a3 as h,s as A,f,o as E,k as o,ad as v,u as g,F as O}from"./vue-CP9fVXMC.js";import{J as $,aA as C,aR as D,am as I}from"./antd-Ckg-4fVb.js";var m=(e=>(e.alipay="alipay",e))(m||{});function B(e){return y("/payment/process",e,{customDev:!0})}function F(e){return y("/payment/payStatus",{tradeNo:e},{customDev:!0})}function J(e){return y("/payment/createOrder",e,{customDev:!0})}const U=S({__name:"index",emits:["receiveMsg"],setup(e,{expose:l,emit:n}){const c=n;async function i(s){var a;if(window.EventSource){const _=(a=q().userInfo)==null?void 0:a.id,p=new EventSource(`${R}/sse/create/chargeEvent?tradeNo=${s}&userId=${_}`);p.onmessage=function(r){r.data&&c("receiveMsg",r.data)},p.onerror=r=>{}}}return l({createSse:i}),(s,a)=>(w(),h("div"))}}),T=S({__name:"alipay-qrcode",props:{payPrice:{type:String,required:!0}},emits:["close"],setup(e,{emit:l}){const n=e,c=l,i=A(),s=f(""),a=f(""),u=f(!1);async function _(){const{data:t}=await J({type:m.alipay,payPrice:n.payPrice});a.value=t}async function p(){await i.value.createSse(a.value)}async function r(){u.value=!0,await _(),await p();const{data:t}=await B({type:m.alipay,payPrice:n.payPrice,tradeNo:a.value});s.value=t,u.value=!1}function P(t){const d=JSON.parse(t);d.charge&&d.payPrice==n.payPrice&&c("close",!0)}async function k(){const{data:t}=await F(a.value);["paid","finished"].includes(t)&&c("close",!0)}return E(()=>{r()}),(t,d)=>{const x=$,b=C,M=D,N=I;return w(),h(O,null,[o(U,{ref_key:"sseRef",ref:i,onReceiveMsg:P},null,512),o(N,{open:!0,"ok-text":"已支付",keyboard:!1,"mask-closable":!1,closable:!1,width:320,"cancel-button-props":{disabled:!0},title:"支付宝扫码支付",onOk:k},{default:v(()=>[o(x,{type:"warning",message:"支付成功后页面长时间无响应请点击已支付按钮"}),o(M,{spinning:g(u),tip:"付款码正在加载中"},{default:v(()=>[o(b,{size:270,value:g(s)},null,8,["value"])]),_:1},8,["spinning"])]),_:1})],64)}}});export{m as P,T as _};
