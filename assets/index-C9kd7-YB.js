import{_ as he}from"./index.vue_vue_type_script_setup_true_lang-CWrsniDz.js";import{aP as Ce,d as P,aQ as be,K as we,N as Ie,aa as $e,av as De,aJ as Le,aK as ze,ab as Ne,aL as Re,S as Se,m as Ue,F as Ae,a9 as Ye,Q as Ee,aR as Te,D as Be,ag as Me,a0 as Ve,aw as Oe,an as Fe,s as Qe}from"./antd-BeZGkD-C.js";import{u as je,_ as He,d as Je}from"./edit.vue_vue_type_script_setup_true_lang-CB_FSRxm.js";import{_ as Ke}from"./charge.vue_vue_type_script_setup_true_lang-0G6FCreJ.js";import{_ as Pe}from"./bought.vue_vue_type_script_setup_true_lang-udx-Gppg.js";import{u as Ge}from"./index-C8fbnVQu.js";import{d as qe,f as r,s as G,c as F,r as q,w as Q,o as We,a5 as i,ac as _,ad as e,k as a,u as n,a3 as U,F as A,al as Xe,G as u,af as f,H as j,ag as c,ak as W,a8 as Ze}from"./vue-CP9fVXMC.js";import"./context-BFpfsoUs.js";import"./code-CcXlUPuH.js";import"./refund.vue_vue_type_script_setup_true_lang-Bc0PacU_.js";import"./auto_renew.vue_vue_type_script_setup_true_lang-BVkaIhKY.js";var m=(g=>(g.normal="正常",g.expire="到期",g.excess="超额",g.paid="付费",g.forbidden="禁用",g.delete="注销",g))(m||{});const et=Ze("span",{"text-20px":"","line-height-32px":"","mr-12px":"","mb-0":"",truncate:"","font-600":""},"用户管理",-1),_t=qe({__name:"index",setup(g){const $=r(!1),Y=r(!1),E=G([{title:"邮箱",dataIndex:"email",width:120,ellipsis:!0},{title:"用户名",dataIndex:"userName"},{title:"余额",dataIndex:"money"},{title:"剩余流量",dataIndex:"leftTraffic"},{title:"等级",dataIndex:"grade"},{title:"等级到期",dataIndex:"classExpire"},{title:"注册时间",dataIndex:"regDate"},{title:"状态",dataIndex:"status"},{title:"操作",dataIndex:"action",fixed:"right",width:350}]),v=F(()=>E.value.map(t=>t.dataIndex)),T=r(),p=q({indeterminate:!1,checkAll:!0,checkList:v.value}),X=F(()=>E.value.map(t=>t.dataIndex==="action"?{label:t.title,value:t.dataIndex,disabled:!0}:{label:t.title,value:t.dataIndex})),Z=F(()=>{const t={};for(const l in m)t[l]=m[l];return t}),H=r(),k=q({pageSize:10,current:1,total:0,pageSizeOptions:["10","20","30","40"],showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`${t}条记录`,onChange(t,l){k.pageSize=l,k.current=t,w()}}),d=r({}),h=r(!1);async function w(){if(!$.value){$.value=!0;try{const{data:t}=await je({size:k.pageSize,current:k.current,param:d.value});H.value=t.records,k.total=t.total,k.pageSize=t.size,k.current=t.current}finally{$.value=!1}}}function D(t){return E.value.filter(l=>t.includes(l.dataIndex))}const I=r(D(v.value));function ee(t){Object.assign(p,{checkList:t.target.checked?v.value:[],indeterminate:!0}),I.value=t.target.checked?D(v.value):I.value.filter(l=>l.dataIndex==="action")}Q(()=>p.checkList,t=>{p.indeterminate=!!t.length&&t.length<v.value.length,p.checkAll=t.length===v.value.length});function te(){p.checkList=v.value,I.value=D(v.value)}const ae=r();function ne(){w()}function le(t){const l=D(t);I.value=l}function oe(t){T.value=t.id,h.value=!0}async function ue(t){await Je(t),Ge().success("用户删除成功"),await w()}function se(){T.value=void 0,h.value=!0}function ie(t){h.value=!1,t&&w()}const L=r();Q(L,t=>{d.value.startClassExpire=t?t[0]:void 0,d.value.endClassExpire=t?t[1]:void 0});const z=r();Q(z,t=>{d.value.startRegTime=t?t[0]:void 0,d.value.endRegTime=t?t[1]:void 0});const N=r(!1),R=G(),B=r();return We(()=>{w()}),(t,l)=>{const J=we,C=Ie,x=$e,de=De,re=Le,ce=ze,S=Ne,K=Re,y=Se,M=Ue,_e=Ae,V=Ye,pe=Ee,fe=Te,me=Be,ge=Me,b=Ve,ve=Oe,ke=Fe,xe=Qe,ye=he;return i(),_(ye,null,{title:e(()=>[et]),default:e(()=>[a(V,{"mb-4":""},{default:e(()=>[a(_e,{modal:n(d)},{default:e(()=>[a(S,{gutter:16},{default:e(()=>[a(x,{span:6},{default:e(()=>[a(C,{label:"用户名",name:"userName"},{default:e(()=>[a(J,{value:n(d).userName,"onUpdate:value":l[0]||(l[0]=o=>n(d).userName=o)},null,8,["value"])]),_:1})]),_:1}),a(x,{span:6},{default:e(()=>[a(C,{label:"邮箱",name:"email"},{default:e(()=>[a(J,{value:n(d).email,"onUpdate:value":l[1]||(l[1]=o=>n(d).email=o)},null,8,["value"])]),_:1})]),_:1}),a(x,{span:4},{default:e(()=>[a(C,{label:"用户等级",name:"grade"},{default:e(()=>[a(de,{value:n(d).grade,"onUpdate:value":l[2]||(l[2]=o=>n(d).grade=o),min:0},null,8,["value"])]),_:1})]),_:1}),a(x,{span:4},{default:e(()=>[a(C,{label:"状态",name:"status"},{default:e(()=>[a(ce,{value:n(d).status,"onUpdate:value":l[3]||(l[3]=o=>n(d).status=o),"allow-clear":!0},{default:e(()=>[(i(!0),U(A,null,Xe(n(Z),(o,s)=>(i(),_(re,{key:s,value:s},{default:e(()=>[u(f(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(S,{gutter:16},{default:e(()=>[a(x,{span:6},{default:e(()=>[a(C,{label:"等级到期"},{default:e(()=>[a(K,{value:n(L),"onUpdate:value":l[4]||(l[4]=o=>j(L)?L.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1}),a(x,{span:6},{default:e(()=>[a(C,{label:"注册时间"},{default:e(()=>[a(K,{value:n(z),"onUpdate:value":l[5]||(l[5]=o=>j(z)?z.value=o:null),placeholder:["开始日期","结束日期"]},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(S,{span:24,style:{"text-align":"right"}},{default:e(()=>[a(x,{span:24},{default:e(()=>[a(M,{flex:"","justify-end":"","w-full":""},{default:e(()=>[a(y,{loading:n(ae),type:"primary",onClick:ne},{default:e(()=>[u(" 查询 ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modal"])]),_:1}),a(S,{gutter:24},{default:e(()=>[a(x,{span:24},{default:e(()=>[a(V,{title:"用户列表"},{extra:e(()=>[a(M,{size:24},{default:e(()=>[a(y,{type:"default",onClick:se},{default:e(()=>[u(" 添加用户 ")]),_:1}),a(ge,{title:"列设置"},{default:e(()=>[a(me,{open:n(Y),"onUpdate:open":l[8]||(l[8]=o=>j(Y)?Y.value=o:null),trigger:"click"},{overlay:e(()=>[a(V,null,{title:e(()=>[a(pe,{checked:n(p).checkAll,"onUpdate:checked":l[6]||(l[6]=o=>n(p).checkAll=o),indeterminate:n(p).indeterminate,onChange:ee},{default:e(()=>[u(" 列选择 ")]),_:1},8,["checked","indeterminate"])]),extra:e(()=>[a(y,{type:"link",onClick:te},{default:e(()=>[u(" 重置 ")]),_:1})]),default:e(()=>[a(fe,{value:n(p).checkList,"onUpdate:value":l[7]||(l[7]=o=>n(p).checkList=o),options:n(X),style:{display:"flex","flex-direction":"column"},onChange:le},null,8,["value","options"])]),_:1})]),default:e(()=>[a(n(Ce))]),_:1},8,["open"])]),_:1})]),_:1})]),default:e(()=>[a(ke,{loading:n($),columns:n(I),"data-source":n(H),pagination:n(k),scroll:{x:1500}},{bodyCell:e(({column:o,record:s})=>[o.dataIndex==="status"?(i(),U(A,{key:0},[s.status==="forbidden"?(i(),_(b,{key:0,color:"purple"},{default:e(()=>[u(f(n(m).forbidden),1)]),_:1})):c("",!0),s.status==="excess"?(i(),_(b,{key:1,color:"orange"},{default:e(()=>[u(f(n(m).excess),1)]),_:1})):c("",!0),s.status==="normal"?(i(),_(b,{key:2,color:"cyan"},{default:e(()=>[u(f(n(m).normal),1)]),_:1})):c("",!0),s.status==="paid"?(i(),_(b,{key:3,color:"green"},{default:e(()=>[u(f(n(m).paid),1)]),_:1})):c("",!0),s.status==="expire"?(i(),_(b,{key:4,color:"blue"},{default:e(()=>[u(f(n(m).expire),1)]),_:1})):c("",!0),s.status==="delete"?(i(),_(b,{key:5,color:"red"},{default:e(()=>[u(f(n(m).delete),1)]),_:1})):c("",!0)],64)):c("",!0),o.dataIndex==="classExpire"?(i(),U(A,{key:1},[u(f(n(P)(s.classExpire).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="regDate"?(i(),U(A,{key:2},[u(f(n(P)(s.regDate).format("YYYY-MM-DD")),1)],64)):c("",!0),o.dataIndex==="action"?(i(),_(M,{key:3},{default:e(()=>[a(y,{type:"default",onClick:O=>oe(s)},{default:e(()=>[u(" 修改 ")]),_:2},1032,["onClick"]),a(y,{type:"default",onClick:O=>{B.value=s,N.value=!0,R.value=Pe}},{default:e(()=>[u(" 购买记录 ")]),_:2},1032,["onClick"]),a(y,{type:"default",onClick:O=>{B.value=s,N.value=!0,R.value=Ke}},{default:e(()=>[u(" 充值记录 ")]),_:2},1032,["onClick"]),a(ve,{title:"确定要删除用户吗？",onConfirm:O=>ue(s.id)},{icon:e(()=>[a(n(be))]),default:e(()=>[a(y,{danger:"",type:"primary"},{default:e(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):c("",!0)]),_:1},8,["loading","columns","data-source","pagination"])]),_:1})]),_:1})]),_:1}),a(xe,{title:"编辑用户",width:720,visible:n(h),"body-style":{paddingBottom:"80px"},onClose:l[9]||(l[9]=o=>h.value=!1)},{default:e(()=>[n(h)?(i(),_(W(He),{key:0,"user-id":n(T),onHandleClose:ie},null,40,["user-id"])):c("",!0)]),_:1},8,["visible"]),n(N)?(i(),_(W(n(R)),{key:0,user:n(B),onClose:l[10]||(l[10]=o=>{N.value=!1,R.value=void 0})},null,40,["user"])):c("",!0)]),_:1})}}});export{_t as default};
